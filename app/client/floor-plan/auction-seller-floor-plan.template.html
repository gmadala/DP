<div nxg-search
     title="{{ 'Find a Floor Plan' | translate }}"
     class="search-form"
     prompt="{{ 'VIN, Make, Model, or Year' | translate }}"
     filter-label="{{ 'Filter by Status' | translate }}"
     filter-options="filterOptions"
     active-criteria="floorplanData.searchCriteria"
     on-search="floorplanData.sellerSearch(floorplanData.searchCriteria)"
     on-clear="floorplanData.resetSellerSearch(filterOptions)"
     help-text="{{ 'Date range based on Date Floored OR Disbursement Date.' | translate }}"
     filterable="true">
</div>

<div class="well" ng-switch="floorplanData.results.length > 0 || floorplanData.loading">
  <h2 class="well-title" translate>Floor Plan</h2>
  <p class="notice-box" ng-switch-when="false" translate>
    Sorry, no results found. Please <a ng-click="resetSellerSearch()" title="New Search">try a new search</a>.
  </p>
  <section ng-switch-when="true"
           nxg-infinite-scroll="floorplanData.fetchNextSellerResults()"
           nxg-infinite-scroll-disabled="floorplanData.loading"
           nxg-infinite-scroll-show-indicator="floorplanData.loading">

    <table class="table table-striped table-primary">
      <thead>
      <th class="sortable"
          ng-click="floorplanData.sortSellerBy('FlooringDate')"
          ng-class="{ sorted : floorplanData.searchCriteria.sortField == 'FlooringDate', desc : floorplanData.searchCriteria.sortDescending }">
        <nxg-sortable sortable-text="{{ 'Dates' | translate }}"></nxg-sortable>
      </th>
      <th class="sortable"
          ng-click="floorplanData.sortSellerBy('UnitMake')"
          ng-class="{ sorted : floorplanData.searchCriteria.sortField == 'UnitMake', desc : floorplanData.searchCriteria.sortDescending }">
        <nxg-sortable sortable-text="{{ 'Description' | translate }}"></nxg-sortable>
      </th>
      <th translate>Status</th>
      <th translate>Purchased For</th>
      <th class="sortable"
          ng-click="floorplanData.sortSellerBy('BuyerBusinessName')"
          ng-class="{ sorted : floorplanData.searchCriteria.sortField == 'BuyerBusinessName', desc : floorplanData.searchCriteria.sortDescending }">
        <nxg-sortable sortable-text="{{ 'Buyer' | translate }}"></nxg-sortable>
      </th>
      <th translate>Ticket No.</th>
      <th translate>Title Location</th>
      <th translate>Title</th>
      </thead>

      <tr ng-repeat="item in floorplanData.results">
        <td class="date">
          <h4>{{ (item.FlooringDate | moment) || 'n/a'}}</h4>
          <p translate>Floored</p>
          <br/>
          <h4>{{ (item.DisbursementDate | moment) || 'n/a' }}</h4>
          <p translate>Disbursement</p>
        </td>
        <td class="description-narrow">
          <p class="lockup-major" nxg-highlight="item.Description" highlight="item.data.query"></p>
          <p class="lockup-minor caps">
            <span translate>VIN</span>: <span nxg-highlight="item.UnitVin" highlight="searchCriteria.query" class="break-word"></span>
          </p>
          <p class="lockup-minor caps">
                        <span><span translate>STK</span>: <span nxg-highlight="item.StockNumber" highlight="searchCriteria.query"
                                                                class="break-word"></span></span>
          </p>
          <p class="lockup-minor caps" ng-show="item.ExternalStockNumber">
            <span translate>External Stock #</span>: <span nxg-highlight="item.ExternalStockNumber" highlight="searchCriteria.query"
                                                           class="break-word"></span>
          </p>
        </td>
        <td>
          <h5>{{ item.FloorplanStatusName }}</h5>
        </td>
        <td class="numeric">
          <h4>{{ item.PurchaseAmount | currency }}</h4>
        </td>
        <td class="buyer">
          <h5>{{ item.BuyerName }}</h5>
          <p class="lockup-minor" ng-show="item.ExternalBuyerId">
            <span translate>External Buyer ID</span>: <span nxg-highlight="item.ExternalBuyerId" highlight="searchCriteria.query"
                                                            class="break-word"></span>
          </p>
          <p class="lockup-minor" ng-show="item.ExternalSellerId">
            <span translate>External Seller Id</span>: <span nxg-highlight="item.ExternalSellerId" highlight="searchCriteria.query"
                                                             class="break-word"></span>
          </p>
        </td>
        <td>
          <h4>{{ item.ConsignerTicketNumber }}</h4>
        </td>
        <td>
          <h5>{{ item.TitleLocation }}</h5>
          <input type="hidden" ng-model="item.sellerHasTitleChanged"/>
          <div class="seller-has-title-box cr-inline-narrow" ng-show="item.TitleEditable">
            <input type="checkbox" id="{{ item.FloorplanId }}" name="sellerHasTitle"
                   ng-model="item.sellerHasTitle"
                   ng-click="sellerHasTitle(item, item.sellerHasTitle)"/>
            <label class="checkbox-img small"
                   for="{{ item.FloorplanId }}" ng-if="hideTooltip(item.sellerHasTitle, item.sellerHasTitleChanged)">
            </label>
            <label class="checkbox-img small"
                   for="{{ item.FloorplanId }}"
                   ng-show="showTooltip(item.sellerHasTitle, item.sellerHasTitleChanged)"
                   tooltip-placement="top"
                   tooltip-trigger="mouseenter"
                   uib-tooltip="{{ 'NextGear Capital has been notified of this change and will be sending funding soon.' | translate }}"
                   tooltip-animation="true" translate>
            </label>
            <div class="medium-left-margin">
              <label for="{{ item.FloorplanId }}" class="cr-label" translate>
                I Have the Title
              </label></div>
          </div>
        </td>
        <td>
          <a class="btn btn-square" ng-show="item.TitleImageAvailable"
             ng-href="{{ item.$titleURL }}"
             target="_blank">
            <span nxg-icon="icon-title"></span>
          </a>
        </td>
      </tr>
    </table>
  </section>
</div>
