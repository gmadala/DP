<div class="container">
  <section class="row">
    <section class="col-sm-9">
      <div class="info-block">
        <div class="info-block-image">
          <span nxg-icon="icon-info"></span>
        </div>
        <h6 class="info-block-text" translate>Titles released here are required to be returned within seven days. If you are requesting a title for state work, please <a nxg-chat-with-us>chat with us</a> or contact customer service for further assistance.</h6>
      </div>
      <div nxg-search
           title="{{ 'Title Release Search' | translate }}"
           class="search-form"
           prompt="{{ 'Stock #, VIN, Make, Model, or Year' | translate }}"
           filter-label="{{ 'Filter by Status' | translate }}"
           filter-options="filterOptions"
           active-criteria="searchParams.proposedSearchCriteria"
           show-date-range="true"
           on-search="search()"
           on-clear="resetSearch()"
           filterable="true"
           hide-clear="true">
      </div>

      <div class="panel panel-default" ng-switch="data.results.length > 0 || data.loading">
        <h2 class="well-title"><span translate>Title Release Requests</span>
          <div uib-dropdown class="pull-right visible-xs">
            <button class="btn-unstyle dropdown-toggle sort-by right no-padding no-margin" type="button" id="dropdownSort" uib-dropdown-toggle
                    aria-haspopup="true" aria-expanded="false">
              <strong translate>Sort By</strong>
              <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownSort">
              <li ng-click="sortBy('FlooringDate')"><a translate>Floored</a></li>
              <li ng-click="sortBy('UnitMake')"><a translate>Description</a></li>
              <li ng-click="sortBy('PurchaseDate')"><a translate>Purchased</a></li>
            </ul>
          </div>
        </h2>
        <p class="notice-box" ng-switch-when="false" translate>
          Sorry, no results found. Please <a ng-click="resetSearch()" title="New Search">try a new search</a>.
        </p>

        <div ng-switch-when="true"
             nxg-infinite-scroll="fetchNextResults()"
             nxg-infinite-scroll-disabled="data.loading"
             nxg-infinite-scroll-show-indicator="data.loading">
          <table class="table table-striped table-primary requests-grid">
            <thead>
            <th class="sortable hidden-xs"
                ng-click="sortBy('FlooringDate')"
                ng-class="{ sorted : sortField == 'FlooringDate', desc : sortDescending }">
              <nxg-sortable sortable-text="{{ 'Floored' | translate }}"></nxg-sortable>
            </th>
            <th class="sortable hidden-xs"
                ng-click="sortBy('UnitMake')"
                ng-class="{ sorted : sortField == 'UnitMake', desc : sortDescending }">
              <nxg-sortable sortable-text="{{ 'Description' | translate }}"></nxg-sortable>
            </th>
            <th class="sortable hidden-xs hidden-sm"
                ng-click="sortBy('PurchaseDate')"
                ng-class="{ sorted : sortField == 'PurchaseDate', desc : sortDescending }">
              <nxg-sortable sortable-text="{{ 'Purchased' | translate }}"></nxg-sortable>
            </th>
            <th class="hidden-xs" translate>Release Status</th>
            <th class=" hidden-xs" translate>Actions</th>
            </thead>
            <tr ng-repeat="item in data.results">

              <td class="hidden-xs">
                <p class="lockup-major">{{ item.FlooringDate | moment}}</p>
                <p class="lockup-minor">{{ item.DaysFloored }} <span translate>days</span></p>
                <p class="lockup-major visible-sm"><span translate>Purchased</span>:</p>
                <p class="lockup-minor visible-sm">{{item.UnitPurchaseDate | moment}}</p>
              </td>
              <td class="description">
                <div class="col-xs-12 no-padding">
                  <a class="lockup-major" href="#/vehicledetails?stockNumber={{ item.StockNumber }}">
                    <span nxg-highlight="getVehicleDescription(item)" highlight="item.data.query"></span>
                  </a>
                  <div>
                    <p class="lockup-minor caps vin"><span translate>VIN</span>: <span nxg-highlight="item.UnitVIN" highlight="item.data.query"
                                                                                       class="break-word"></span></p>
                    <p class="lockup-minor caps stock"><span translate>STK</span>: <span nxg-highlight="item.StockNumber" highlight="item.data.query"></span>
                    </p>
                  </div>
                </div>
                <div class="col-xs-6 no-padding visible-xs">
                  <p class="lockup-minor vertical-spacing heavy"><span translate>Floored On</span>:</p>
                </div>
                <div class="col-xs-6 no-padding visible-xs">
                  <p class="lockup-minor vertical-spacing"><span>{{ item.FlooringDate | moment}}</span></p>
                </div>
                <div class="col-xs-6 no-padding visible-xs">
                  <p class="lockup-minor vertical-spacing heavy"><span translate>Purchased</span>:</p>
                </div>
                <div class="col-xs-6 no-padding visible-xs">
                  <p class="lockup-minor vertical-spacing"><span>{{ item.UnitPurchaseDate | moment}}</span></p>
                </div>
                <div class="col-xs-6 no-padding visible-xs">
                  <p class="lockup-minor vertical-spacing heavy"><span translate>Status</span>:</p>
                </div>
                <div class="col-xs-6 no-padding visible-xs">
                  <div class="lockup-minor vertical-spacing" ng-switch="item.TitleReleaseProgramStatus">
                    <p ng-switch-when="OutstandingTitleReleaseProgramRelease"><span translate>Title Released on</span> {{item.TitleReleaseDate | moment}}</p>
                    <p ng-switch-when="EligibleForRelease" translate>Eligible for Title Release</p>
                    <p ng-switch-when="NotEligibleForRelease" translate>Not Eligible for Title Release</p>
                  </div>
                </div>
                <div class="col-xs-6 no-padding visible-xs">
                  <p class="lockup-minor vertical-spacing heavy"><span translate>Actions</span>:</p>
                </div>
                <div class="col-xs-6 no-padding visible-xs">
                  <div class="lockup-minor vertical-spacing" ng-switch="item.TitleReleaseProgramStatus">
                    <h6 ng-switch-when="OutstandingTitleReleaseProgramRelease" translate>Pay off this vehicle or return the title to remove from your
                      limit.</h6>
                    <div ng-switch-when="EligibleForRelease">
                      <button type="button" class="btn btn-icon btn-title-request" ng-click="toggleSelected(item)" ng-switch="isFloorplanOnQueue(item)"
                              ng-class="{selected: isFloorplanOnQueue(item)}"
                              ng-disabled="$parent.eligibilityLoading() || (!isFloorplanOnQueue(item) && $parent.eligibility.RemainingReleasesAvailable <= $parent.queueLength())">
                        <span ng-switch-when="true">
                          <span translate>Added</span>
                          <span nxg-icon="icon-minus" class="icon-small"></span>
                        </span>
                        <span ng-switch-default>
                          <span translate>Request Title</span><span nxg-icon="icon-plus" class="icon-small"></span>
                        </span>
                      </button>
                    </div>
                    <a ng-switch-when="NotEligibleForRelease" ng-click="titleReleaseUnavailable()" translate>
                      Title Release Unavailable
                    </a>
                  </div>
                </div>
              </td>
              <td class="date hidden-xs hidden-sm">
                <p>{{item.UnitPurchaseDate | moment}}</p>
              </td>
              <td class="hidden-xs" ng-switch="item.TitleReleaseProgramStatus">
                <p ng-switch-when="OutstandingTitleReleaseProgramRelease" translate>Title Released on {{item.TitleReleaseDate | moment}}</p>
                <p ng-switch-when="EligibleForRelease" translate>Eligible for Title Release</p>
                <p ng-switch-when="NotEligibleForRelease" translate>Not Eligible for Title Release</p>
              </td>
              <td class="actions hidden-xs" ng-switch="item.TitleReleaseProgramStatus">
                <h6 ng-switch-when="OutstandingTitleReleaseProgramRelease" translate>Pay off this vehicle or return the title to remove from your limit.</h6>
                <div ng-switch-when="EligibleForRelease">
                  <button type="button" class="btn btn-icon btn-title-request" ng-click="toggleSelected(item)" ng-switch="isFloorplanOnQueue(item)"
                          ng-class="{selected: isFloorplanOnQueue(item)}"
                          ng-disabled="$parent.eligibilityLoading() || (!isFloorplanOnQueue(item) && $parent.eligibility.RemainingReleasesAvailable <= $parent.queueLength())">
                  <span ng-switch-when="true">
                    <span translate>Added</span><span nxg-icon="icon-minus" class="icon-small"></span>
                  </span>
                  <span ng-switch-default>
                    <span translate>Request Title</span><span nxg-icon="icon-plus" class="icon-small"></span>
                  </span>
                  </button>
                </div>
                <a ng-switch-when="NotEligibleForRelease" ng-click="titleReleaseUnavailable()" translate>
                  Title Release Unavailable
                </a>
              </td>
            </tr>
          </table>
        </div>

        <p class="text-error notice-box" ng-show="data.hitInfiniteScrollMax" translate>
          There are too many results to display, please refine your search further.
        </p>
      </div>
    </section>
    <div class="col-sm-3 hidden-xs">
      <section class="panel panel-default request-queue sticky"
               nxg-requests-summary
               eligibility="eligibility"
               nxg-sticky
               header=".nxg-sticky-header"
               footer=".well-footer"
               scroll=".queue-list">
      </section>
    </div>
    <div class="visible-xs mobile-checkout-widget hidden-print">
      <button class="visible-xs btn-cta cta-primary" ng-click="navigate('titleReleaseCheckout')">
        <span class="paired-body">({{queueLength()}}) <span translate>Confirm Requests</span></span>
      </button>
    </div>
  </section>
</div>
