<section class="row-fluid">
  <section class="span9">
    <div nxg-search
      title="Scheduled Payment Search"
      class="search-form schPayments"
      prompt="Stock # or VIN"
      metric-search="{{metric.CLICK_SCHEDULED_PAYMENTS_SEARCH_BUTTON}}"
      metric-clear-search="{{metric.CLICK_SCHEDULED_PAYMENTS_CLEAR_SEARCH_LINK}}"
      metric-filter-by-input="{{metric.CLICK_SCHEDULED_PAYMENTS_FILTER_BY_PAYMENT_STATUS}}"
      metric-filter-from-date="{{metric.CLICK_SCHEDULED_PAYMENTS_FILTER_FROM_DATE_INPUT}}"
      metric-filter-to-date="{{metric.CLICK_SCHEDULED_PAYMENTS_FILTER_TO_DATE_INPUT}}"
      metric-filter-by-inventory-location="{{metric.CLICK_PAYMENTS_FILTER_BY_INVENTORY_LOCATION}}"
      filter-label="Filter by Payment Status"
      filter-options="scheduledPayments.filterOptions"
      active-criteria="scheduledPayments.searchCriteria"
      on-search="scheduledPayments.search()"
      on-clear="scheduledPayments.resetSearch()"
      filterable="true"
      show-location-filter="true">
    </div>

    <div class="well" ng-switch="fees.results.length > 0 || fees.loading">
    <h2 class="well-title">Scheduled Account Fees</h2>

      <p class="notice-box" ng-switch-when="false">
        There are no fees currently scheduled with this account.
      </p>

      <table class="table table-striped table-primary" ng-switch-when="true">
        <thead>
          <th class="sortable"
               ng-click="sortFeesBy('schFeeDate')"
               ng-class="{ sorted : sortField.fee == 'schFeeDate', desc : sortDescending.fee }">
            Scheduled On
            <span class="sortArrows"></span>
          </th>
          <th class="sortable">
            Description
            <span class="sortArrows"></span>
          </th>
          <th class="sortable"
               ng-click="sortFeesBy('schFeeType')"
               ng-class="{ sorted : sortField.fee == 'schFeeType', desc : sortDescending.fee }">
            Fee Type
            <span class="sortArrows"></span>
          </th>
          <th class="sortable"
               ng-click="sortFeesBy('schFeeAmt')"
               ng-class="{ sorted : sortField.fee == 'schFeeAmt', desc : sortDescending.fee }">
            Fee Amount
            <span class="sortArrows"></span>
          </th>
        </thead>

        <tr ng-repeat="fee in fees.results | orderBy:sortField.fee:sortDescending.fee">
            <td><p>{{ fee.ScheduledDate | moment }}</p></td>
            <td><h5>{{ fee.Description }}</h5></td>
            <td><p>{{ fee.FeeType }}</p></td>
            <td><p>{{ fee.Balance | currency }}</p>
              <a ng-click="scheduledPayments.cancelFee(fee)" nxg-track="{{metric.CLICK_SCHEDULED_PAYMENTS_VEHICLE_CANCEL_FEE_BUTTON}}">
                  <span>Cancel</span>
              </a>
            </td>
        </tr>
      </table>
    </div><!-- end .sch-fees -->

    <div class="well" ng-switch="scheduledPayments.results.length > 0 || scheduledPayments.loading">
      <h2 class="well-title">Scheduled Vehicle Payments</h2>

      <p class="no-results" ng-switch-when="false">
        Sorry, no results found. Please <a ng-click="scheduledPayments.resetSearch()" title="New Search">try a new search</a>.
      </p>

      <div ng-switch-when="true"
        nxg-infinite-scroll="scheduledPayments.loadMoreData()"
        nxg-infinite-scroll-disabled="scheduledPayments.loading"
        nxg-infinite-scroll-show-indicator="scheduledPayments.loading">

        <p class="text-error notice-box" ng-show="canPayNowLoaded && !canPayNow">
          Note: Payoff and due amounts may change. Interest and/or fees may continue to accrue between now and your scheduled payment.<br/>
          Note: No payment may be scheduled on an overdue loan, or a loan due today.
        </p>

        <table class="table table-striped table-primary">
          <thead>
            <th class="sortable"
                 ng-click="sortPaymentsBy('ScheduledForDate')"
                 ng-class="{ sorted : sortField.payment == 'ScheduledForDate', desc : sortDescending.payment }">
              Scheduled On
              <span class="sortArrows"></span>
            </th>
            <th class="sortable">
              Description
              <span class="sortArrows"></span>
            </th>
            <th class="sortable"
                 ng-click="sortPaymentsBy('flooringDate')"
                 ng-class="{ sorted : sortField.payment == 'flooringDate', desc : sortDescending.payment }">
              Floored
              <span class="sortArrows"></span>
            </th>
            <th class="sortable">
              Status
              <span class="sortArrows"></span>
            </th>
            <th class="sortable"
                 ng-click="sortPaymentsBy('paymentAmount')"
                 ng-class="{ sorted : sortField.payment == 'paymentAmount', desc : sortDescending.payment }">
              Amount
              <span class="sortArrows"></span>
            </th>
          </thead><!-- end .table-list-head -->

          <tr ng-repeat="pay in scheduledPayments.results">

              <td>
                <p class="lockup-major"> {{ pay.scheduledDate | moment }} </p>
                <p>Scheduled By:</p>
                <p>{{ pay.scheduledBy }}</p>
              </td>

              <td class="description">
                <a class="lockup-major" href="#/vehicledetails?stockNumber={{ pay.stockNumber }}"> {{ pay.description }} </a>
                <div class="row-fluid">
                  <p class="lockup-minor caps vin">VIN: <span nxg-highlight="pay.vin" highlight="pay.data.query" class="break-word"></span></p>
                  <p class="lockup-minor caps stock">STK: <span nxg-highlight="pay.stockNumber" highlight="pay.data.query"></span></p>
                </div>
              </td>

              <td>
                <p class="lockup-major">{{ pay.flooringDate | moment }}</p>
                <p class="lockup-minor">{{ pay.daysOnFloorplan }} Days</p>
              </td>

              <td>
                <p>
                  <span class="sch-label"> {{ pay.status }} </span><br/>
                  <span ng-show="pay.statusDate">as of:</span>
                   {{ pay.statusDate | moment }}
                </p>
                <a class="receipt-link" ng-show="pay.isProcessed" ng-href="{{ pay.receiptURL }}" target="_blank">View Receipt</a>
              </td>

              <td>
                <p class="lockup-major">{{ pay.paymentAmount | currency }} </p>
                <p class="lockup-minor">{{(pay.isCurtailment && 'Curtailment' || Payoff)}} </p>


                <a ng-show="pay.isPending" ng-disabled="scheduledPayments.isOnPaymentQueue(pay) || paymentInProgress()" ng-click="scheduledPayments.payOff(pay)">
                    <span>Payoff Now</span>
                </a>

                <a ng-show="pay.isPending" ng-click="scheduledPayments.cancelPayment(pay)">
                    <span>Cancel</span>
                </a>
              </td>
          </tr>
        </table>

        <p class="text-error notice-box" ng-show="hitInfiniteScrollMax">
          There are too many results to display, please refine your search further.
        </p>
      </div>
    </div>
  </section>

  <section class="span3 well sticky pay-queue" nxg-payment-summary nxg-sticky empty-message="Click the Payoff Now button to add a payoff or a payment."></section>
</section>
