<div class="container-line">
  <div class="container-fluid settings profile">
    <div class="row-fluid">

      <!-- USER PROFILE -->
      <section class="span6 well settings-well">
        <h2 class="well-title">User Profile
          <button ng-hide="profile.editable" class="btn edit-btn" ng-click="profile.edit()"><i class="glyphicon glyphicon-pencil"></i>Edit</button>
          <button ng-show="profile.editable" class="btn cancel-btn" ng-click="profile.cancel()">Cancel</button>
          <button ng-show="profile.editable" class="btn save-btn" ng-click="profile.save()">Save</button>
        </h2>
        <form class="form-block" ng-class="{ editable:profile.editable }" name="userSettings" novalidate>
          <div class="row-fluid">
            <label class="span4" for="setUsername">User Name</label>
            <div class="span8" nxg-input model="profile.data.username" editable="profile.editable">
              <input type="text" name="setUsername" ng-model="profile.dirtyData.username" value="profile.dirtyData.username" ng-maxlength="40" ng-class="{ 'nxg-invalid': profile.validation.setUsername.$error.required || profile.validation.setUsername.$error.maxlength }" required/>
              <label for="setUsername" class="text-error"
                     ng-show="profile.validation.setUsername.$error.required">
                Please enter a User Name.
              </label>
              <label for="setUsername" class="text-error"
                     ng-show="profile.validation.setUsername.$error.maxlength">
                Please enter a User Name that is 40 characters or less.
              </label>
            </div>
          </div>

          <div class="row-fluid">
            <label class="span4" for="setPassword"><span ng-show="editable">New </span>Password</label>
            <div class="span8">
              <div class="static" ng-hide="profile.editable">***********</div>
              <div ng-show="profile.editable">
                <input type="password" name="setPassword" ng-model="profile.dirtyData.password" ng-class="{ 'nxg-invalid': profile.validation.setPassword.$error.pattern }" />
                  <button class="btn-help"
                          tooltip-placement="right"
                          tooltip-trigger="click"
                          tooltip-html="true"
                          tooltip-html-unsafe="<h5>Password Reset</h5><p>Passwords must consist of a minimum of 8 characters.</p><p>Passwords must contain 3 of the 4 following types of characters: uppercase, lowercase, number, or special characters.</p>"
                          tooltip-animation="true"><span nxg-icon="icon-help"></span></button>
              </div>

              <label for="setPassword" class="text-error" ng-show="profile.validation.setPassword.$error.pattern">
                Please enter a valid password.
              </label>
            </div>
          </div>

          <div class="row-fluid" ng-show="profile.editable">
            <label class="span4" for="confirmPassword">Confirm Password</label>
            <div class="span8">
              <input type="password" id="confirmPassword" ng-model="profile.dirtyData.passwordConfirm" ng-class="{ 'nxg-invalid': profile.validation.setPassword.$error.nomatch }" />
              <label for="confirmPassword" class="text-error" ng-show="profile.validation.setPassword.$error.nomatch">
                The passwords do not match. Please re-enter the password.
              </label>
            </div>
          </div>

          <div ng-repeat="question in profile.data.questions" ng-hide="profile.editable">
            <!-- Question Select -->
            <div class="row-fluid">
              <label class="span4">Security Question {{$index + 1}}</label>
              <div class="span8 static" ng-hide="profile.editable"> {{ question.QuestionText }} </div>
            </div>
          </div>

          <div ng-repeat="question in profile.dirtyData.questions" ng-show="profile.editable">
            <!-- Question Select -->
            <div class="row-fluid">
              <label class="span4">Security Question {{$index + 1}}</label>
              <div class="span8 style-select">
                <select ng-model="question.SecurityQuestionId"
                        ng-options="q.QuestionId as q.QuestionText for q in profile.data.allQuestions"
                        tooltip="{{ question.QuestionText }}"
                        tooltip-placement="right"
                        tooltip-popup-delay="700">
                </select>
              </div>
            </div>

            <!-- Answer -->
            <div class="row-fluid" ng-show="profile.editable">
              <label class="span4" for="secAnswer">Answer</label>
              <div class="span8">
                <input type="text" name="secAnswer" ng-model="question.Answer" ng-class="{ 'nxg-invalid': question.$error.required || question.$error.maxLength }" required/>

                <label class="text-error" ng-show="question.$error.required">
                  Please enter an Answer.
                </label>
                <label class="text-error" ng-show="question.$error.maxLength">
                  Please enter an Answer that is a maximum of 100 characters.
                </label>
              </div>
            </div>
          </div>

          <div class="row-fluid">
            <label class="span4" for="email">Email</label>
            <div class="span8" nxg-input model="profile.data.email" editable="profile.editable">
              <input type="email" name="email" ng-model="profile.dirtyData.email" value="profile.dirtyData.email" ng-class="{ 'nxg-invalid': profile.validation.email.$invalid }" required/>
              <label class="text-error" ng-show="profile.validation.email.$invalid">
                Please enter a valid email address.
              </label>
            </div>
          </div>

          <div class="row-fluid">
            <label class="span4" for="phone">Phone</label>
            <div class="span8" nxg-input model="formatPhonenumber(profile.data.phone)" editable="profile.editable">
              <input type="tel"
                     name="phone"
                     ng-model="profile.dirtyData.phone"
                     ng-pattern="phonePattern"
                     size="10"
                     ng-class="{ 'nxg-invalid': profile.validation.phone.$error.pattern }" />
                <label class="text-error" ng-show="profile.validation.phone.$error.pattern">
                    Please enter a valid phone number.
                </label>
            </div>
          </div>
        </form>
      </section>

      <!-- NOTIFICATIONS -->
      <section class="span6 well settings-well">
        <h2 class="well-title">Notifications
          <button ng-hide="notifications.editable" class="btn edit-btn" ng-click="notifications.edit()"><i class="glyphicon glyphicon-pencil"></i>Edit</button>
          <button ng-show="notifications.editable" class="btn cancel-btn" ng-click="notifications.cancel()">Cancel</button>
          <button ng-show="notifications.editable" class="btn save-btn" ng-click="notifications.save()">Save</button>
        </h2>

        <form class="form-block" ng-class="{ editable:notifications.editable }" name="notificationSettings">
          <div class="row-fluid">
            <h6 class="span6">Notifications</h6>
            <h6 class="span6" ng-hide="notifications.editable || notifications.data.selected.length == 0">Delivery Type</h6>
          </div>

          <ul>
            <li class="row-fluid" ng-repeat="n in notifications.data.selected" ng-hide="notifications.editable || notifications.data.selected.length == 0">
              <div class="span4">{{ n.NotificationName }}</div>
              <div class="span8">
                <p>
                  <span ng-repeat="d in n.DeliveryMethods">
                    {{ d.DeliveryMethodName }}<span ng-show="$index < n.DeliveryMethods.length - 1">, </span>
                  </span>
                </p>
              </div>
            </li>
            <li ng-show="notifications.data.selected.length == 0 && !notifications.editable">No notifications are currently enabled.</li>

            <!-- Edit -->
            <li class="row-fluid" ng-repeat="n in notifications.dirtyData.available" ng-show="notifications.editable">
              <div class="span4">{{ n.Name }}</div>
              <div class="span8 cr-inline">
                <span ng-repeat="d in n.DeliveryMethods">
                  <input type="checkbox" id="{{ n.NotificationId + d.DeliveryMethodId }}" name="{{ d.Name }}" ng-model="d.Enabled" />
                  <label class="checkbox-img small" for="{{ n.NotificationId + d.DeliveryMethodId }}"></label>
                  <label class="cr-label" for="{{ n.NotificationId + d.DeliveryMethodId }}">{{ d.Name }}</label>
                </span>
              </div>
            </li>
          </ul>
        </form>
      </section>
    </div>
  </div><!-- end .container-fluid -->
</div><!-- end .container-line -->
