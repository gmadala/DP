<section class="row-fluid upcoming">
  <!-- Calendar -->
  <div class="span9 nxg-dash-calendar-container well dash-well" >
    <div class="dash-calendar-header">
      <h5>
        <a href class="featured today-btn" ng-class="{ 'disabled': isPast() }" ng-click="onClickToday()">Today:</a>
        {{ today }}
      </h5>

      <div class="cta btn-toggle">
        <div class="btn-slider" ng-class="{ 'active-left':isWeekMode(), 'active-right':!isWeekMode() }"></div>
        <button class="btn" ng-click="changeViewMode('week')">Week</button>
        <button class="btn" ng-click="changeViewMode('month')">Month</button>
      </div>
    </div>

    <div nxg-upcoming-calendar display="viewMode" data="dashboardData.calendarData"></div>

    <div class="dash-calendar-footer" ng-show="viewMode == 'month'">
      <h5>
        <a href class="featured today-btn" ng-class="{ 'disabled': isPast() }" ng-click="onClickToday()">Today:</a>
        {{ today }}
      </h5>

      <div class="cta btn-toggle">
        <div class="btn-slider" ng-class="{ 'active-left':isWeekMode(), 'active-right':!isWeekMode() }"></div>
        <button class="btn" ng-click="changeViewMode('week')">Week</button>
        <button class="btn" ng-click="changeViewMode('month')">Month</button>
      </div>

      <table class="fc-header" style="width:100%">
        <tbody>
          <tr>
            <td class="fc-header-left"></td>
            <td class="fc-header-center">
              <span class="fc-button fc-button-prev fc-state-default fc-corner-left fc-corner-right" unselectable="on" ng-click="onClickPrev()" ng-class="{ 'fc-state-disabled': isPast() }">
                <span class="fc-text-arrow">‹</span>
              </span>
              <span class="fc-header-space"></span>
              <span class="fc-header-title">
                <h2>{{ getCalendarTitle() }}</h2>
              </span>
              <span class="fc-header-space"></span>
              <span class="fc-button fc-button-next fc-state-default fc-corner-left fc-corner-right" unselectable="on" ng-click="onClickNext()">
                <span class="fc-text-arrow">›</span>
              </span>
            </td>
            <td class="fc-header-right"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Upcoming Payments Table -->
    <div collapse="isCollapsed" ng-init="isCollapsed = true" ng-class="{ open: !isCollapsed }">
      <div class="upcoming-payments table-holder">
        <table class="table table-striped table-secondary table-border">
          <thead>
            <tr>
              <th>Due Date</th>
              <th>Description</th>
              <th>Payoff Due</th>
              <th>Payment Due</th>
            </tr>
          </thead>
          <tr ng-repeat="payment in dashboardData.UpcomingPaymentsList">
            <td class="center" ng-switch="getDueStatus(payment)">
              <div class="paired" ng-switch-when="overdue">
                <span class="paired-media" nxg-icon="icon-alert"></span>
                <span class="paired-body color-danger value">
                  {{ payment.DueDate | moment }}
                </span>
              </div>

              <div class="paired" ng-switch-when="today">
                <span class="paired-media" nxg-icon="icon-warning"></span>
                <span class="paired-body color-warning value">
                  {{ payment.DueDate | moment }}
                </span>
              </div>

              <div class="paired" ng-switch-when="future">
                <span class="paired-media svg-icon"></span>
                <span class="paired-body">
                  {{ payment.DueDate | moment }}
                </span>
              </div>
            </td>

            <td>
              <a class="primary" href="#/vehicledetails?stockNumber={{ payment.StockNumber }}">{{ payment.Description }}</a>
            </td>
            <td class="numeric">
              <span>{{ payment.PayoffDue | currency }}</span>
            </td>
            <td class="numeric">
              <span>{{ payment.PaymentDue | currency }}</span>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <button class="accordion-button paired-reversed" ng-click="isCollapsed = !isCollapsed" ng-class="{ expanded:!isCollapsed }">
      <span class="paired-body">
        {{  {true:'Show ', false:'Hide ' }[isCollapsed] }} Payment Details
      </span>
      <span class="paired-media" ng-class="{ 'point-up':!isCollapsed, 'point-down':isCollapsed }" nxg-icon="icon-chevron">
      </span>
    </button>
  </div>

  <!-- Payment Summary -->
  <div class="span3 well payment-summary dash-well">
    <h2 class="well-title">Payments Summary</h2>
    <ul class="counter-list">
      <li ng-click="filterPayments('overdue')" nxg-track="{{metric.CLICK_DASHBOARD_PAYMENTS_OVERDUE}}">
        <span class="counter" ng-class="{overdue: dashboardData.OverduePayments > 0}">{{dashboardData.OverduePayments}}</span>
        <div class="dash-lockup">
          <p class="dash-minor" ng-pluralize
              count="dashboardData.OverduePayments"
              when="{'1': 'Overdue', 'other': 'Overdue'}"></p>
          <h4 class="dash-major" ng-class="{'overdue-amount': dashboardData.OverduePaymentAmount > 0}">{{dashboardData.OverduePaymentAmount | currency}}</h4>
        </div>
      </li>
      <li ng-click="filterPayments('today')" nxg-track="{{metric.CLICK_DASHBOARD_PAYMENTS_DUE_TODAY}}">
        <span class="counter" ng-class="{'due-today': dashboardData.PaymentsDueToday > 0}">{{dashboardData.PaymentsDueToday}}</span>
        <div class="dash-lockup">
          <p class="dash-minor" ng-pluralize
              count="dashboardData.PaymentsDueToday"
              when="{'1': 'Due Today', 'other': 'Due Today'}"></p>
          <h4 class="dash-major">{{dashboardData.PaymentsDueTodayAmount | currency}}</h4>
        </div>
      </li>
      <li ng-click="filterPayments('this-week')" nxg-track="{{metric.CLICK_DASHBOARD_PAYMENTS_WEEK}}">
        <span class="counter">{{dashboardData.UpcomingPayments}}</span>

        <div class="dash-lockup">
          <span class="lockup-minor" ng-pluralize
                count="dashboardData.UpcomingPayments"
                when="{'1': 'Payment', 'other': 'Payments'}"></span>
          <span>This {{ viewMode | capitalize }}</span>
          <h4 class="dash-major">{{dashboardData.UpcomingPaymentsAmount | currency}}</h4>
        </div>
      </li>
      <li ng-click="filterPayments()" nxg-track="{{metric.CLICK_DASHBOARD_PAYMENTS_FEES}}">
        <span class="counter">{{dashboardData.AccountFees}}</span>
        <div class="dash-lockup">
          <p class="dash-minor" ng-pluralize
             count="dashboardData.AccountFees"
             when="{'1': 'Account Fee', 'other': 'Account Fees'}"></p>
          <h4 class="dash-major">{{dashboardData.AccountFeeAmount | currency}}</h4>
        </div>
      </li>
            </ul>
      <button class="btn-cta cta-full cta-primary" ng-click="onClickButtonLink('home.payments')" nxg-track="{{metric.CLICK_DASHBOARD_PAYMENTS_VIEW_ALL_PAYMENTS_BUTTON}}">
        <span class="paired-body">View All Payments</span>
        <span class="paired-media" nxg-icon="icon-eye"></span>
      </button>

    <!-- Payments Chart -->
    <div class="payments-chart" collapse="isCollapsed" ng-init="isCollapsed = true" ng-class="{ open: !isCollapsed }">
      <div class="chart-obj"
          nxg-chart
          nxg-chart-type="pie"
          nxg-chart-tooltip="false"
          nxg-chart-size="chartOptions.size"
          nxg-chart-data="chartData.payments"
          nxg-donut-options="chartOptions.donutOptions"
          nxg-chart-title="chartData.paymentsTitle">
      </div>

      <table class="table table-unstyle chart-legend">
        <tr>
          <td><i class="chart-legend-color nxg-chart-fees"></i></td>
          <td class="table-label">Fees</td>
          <td class="table-value numeric">{{ dashboardData.paymentChartData.fees | currency }}</td>
        </tr>
        <tr>
          <td><i class="chart-legend-color nxg-chart-payments"></i></td>
          <td class="table-label">Payments</td>
          <td class="table-value numeric">{{ dashboardData.paymentChartData.payments | currency }}</td>
        </tr>
        <tr class="">
          <td><i class="chart-legend-color nxg-chart-scheduled-payments"></i></td>
          <td class="table-label">Scheduled</td>
          <td class="table-value numeric">
            {{ dashboardData.paymentChartData.scheduledPayments | currency }}
          </td>
        </tr>
      </table>
    </div>
  </div>
</section>

<section class="page-break"></section>

<section class="row-fluid">
  <!-- Credit Summary -->
  <div class="span5 well dash-well">
    <h2 class="well-title">Credit Information</h2>
    <div class="row-fluid credit-chart clearfix">
      <div class="span5 donut-nested">
          <div class="donut-outer"
                nxg-chart
                nxg-chart-type="pie"
                nxg-chart-tooltip="false"
                nxg-chart-size="chartOptions.size"
                nxg-chart-data="chartData.credit.outer"
                nxg-donut-options="chartOptions.donutOptions"
                nxg-chart-title="chartData.creditTitle"></div>
          <div class="donut-inner"
                nxg-chart
                nxg-chart-type="pie"
                nxg-chart-tooltip="false"
                nxg-chart-size="chartOptions.innerSize"
                nxg-chart-data="chartData.credit.inner"
                nxg-donut-options="chartOptions.donutOptions"></div>
      </div>

      <div class="span7">
        <div class="style-select space">
          <select id="lineOfCredit" name="lineOfCredit" ng-model="dashboardData.selectedLineOfCredit" ng-options="loc.CreditTypeName for loc in dashboardData.LinesOfCredit"></select>
        </div>
        <div class="chart-legend">
          <table class="table table-unstyle">
            <tr>
              <td></td>
              <td class="table-label">Total</td>
              <td class="table-symbol">=</td>
              <td class="table-value table-numeric">
                {{ dashboardData.selectedLineOfCredit.LineOfCreditAmount | numeral:'$0,0.00' }}
              </td>
            </tr>
            <tr>
              <td>
                <i class="chart-legend-color nxg-chart-utilized-credit"></i>
              </td>
              <td class="table-label">Utilized</td>
              <td class="table-symbol color-danger">–</td>
              <td class="table-value table-numeric">{{ dashboardData.selectedLineOfCredit.UtilizedCreditAmount | numeral:'$0,0.00' }}</td>
            </tr>
            <tr>
              <td>
                <i class="chart-legend-color nxg-chart-available-credit"></i>
              </td>
              <td class="table-label">Available</td>
              <td class="table-symbol">=</td>
              <td class="table-value table-numeric">{{ dashboardData.selectedLineOfCredit.AvailableCreditAmount | numeral:'$0,0.00' }}</td>
            </tr>
          </table>
        </div>
        <p>This line of credit expires on: {{dashboardData.selectedLineOfCredit.TempLineOfCreditExpiration | moment}}</p>
      </div>
    </div>
    <button class="btn-cta cta-full cta-secondary" href="javascript:void(0)" ng-click="onRequestCredIncr()" nxg-track="{{metric.CLICK_DASHBOARD_REQUEST_CREDIT_INCREASE_BUTTON}}">
        <span class="paired-body">Request Credit Increase</span>
        <span class="paired-media icon-x-small" nxg-icon="icon-triangle"></span>
    </button>
  </div>

  <!-- Receipts Summary -->
  <div class="span4 well dash-well">
    <h2 class="well-title">Recent Receipts</h2>
    <table class="table table-striped table-secondary">
      <thead>
        <th>Receipt Date</th>
        <th>Receipt No.</th>
        <th>Amount</th>
      </thead>
      <tr ng-repeat="receipt in dashboardData.Receipts">
        <td class="table-label">{{ receipt.ReceiptDate | moment }}</td>
        <td class="table-value center"><a ng-href="{{ receipt.$receiptURL }}" target="_blank" nxg-track="{{metric.CLICK_DASHBOARD_VIEW_RECEIPTS}}">#{{ receipt.ReceiptNumber }}</a></td>
        <td class="table-value table-numeric">{{ receipt.ReceiptAmount | currency }}</td>
      </tr>
    </table>
    <button class="btn-cta cta-full cta-secondary" ng-click="onClickButtonLink('home.receipts')" nxg-track="{{metric.CLICK_DASHBOARD_VIEW_ALL_RECEIPTS}}">
      <span class="paired-body">View All Receipts</span>
      <span class="paired-media icon-x-small" nxg-icon="icon-triangle"></span>
    </button>
  </div>

  <!-- Unapplied Funds Summary -->
  <div nxg-unapplied-funds-widget
       balance="dashboardData.UnappliedFundsTotal"
       available="dashboardData.TotalAvailableUnappliedFunds">
  </div>
</section>

<section class="row-fluid">
  <!-- Floor Plan Summary -->
  <div class="span2 well dash-well">
    <h2 class="well-title">Floor Plan</h2>
    <ul>
      <li class="row-fluid">
        <div class="span6">
          <span class="counter">
            {{ dashboardData.ApprovedFloorplans | alt }}
          </span>
        </div>
        <div class="span6 counter-label">
          <span tooltip="This status applies to vehicles floored via NextGearCapital.com or by a NextGear employee via NextGear's Discover system that have been approved and are currently on the NextGear dealer's floor plan."
            tooltip-placement="right"
            tooltip-popup-delay="700">
              <a href="#/home/floorplan?filter=approved">Approved</a>
          </span>
        </div>
      </li>

      <li class="row-fluid">
        <div class="span6">
          <span class="counter">
            {{ dashboardData.PendingFloorplans | alt }}
          </span>
        </div>
        <div class="span6 counter-label">
          <span tooltip="This status applies to vehicles floored via NextGearCapital.com or by a NextGear employee via NextGear's Discover system that have not yet been approved by a NextGear employee."
            tooltip-placement="right"
            tooltip-popup-delay="700">
              <a href="#/home/floorplan?filter=pending">Pending</a>
          </span>
        </div>
      </li>

      <li class="row-fluid">
        <div class="span6">
          <span class="counter">
            {{ dashboardData.DeniedFloorplans | alt }}
          </span>
        </div>
        <div class="span6 counter-label">
          <span tooltip="This status applies to vehicles floored via NextGearCapital.com that have been denied by a NextGear employee. Please contact NextGear Customer Service to find out why a vehicle has been denied."
            tooltip-placement="right"
            tooltip-popup-delay="700">
              <a href="#/home/floorplan?filter=denied">Denied</a>
          </span>
        </div>
      </li>
    </ul>

    <button class="btn-cta cta-full cta-secondary" ng-click="onClickButtonLink('home.floorplan')" nxg-track="{{metric.CLICK_DASHBOARD_VIEW_FLOORPLAN_BUTTON}}">
      <span class="paired-body">View Floorplans</span>
      <span class="paired-media icon-x-small" nxg-icon="icon-triangle"></span>
    </button>
  </div><!-- end .summary.floorplan -->

  <div class="span10 well dash-well infinite">
    <h2 class="well-title">Recently Floored Vehicles</h2>
    <div ng-switch="floorplanData.results.length > 0 || floorplanData.loading">
      <p class="no-results" ng-switch-when="false">
        Sorry, no results found.
      </p>

      <div ng-switch-when="true"
           nxg-infinite-scroll="floorplanData.fetchNextResults()"
           nxg-infinite-scroll-disabled="floorplanData.loading"
           nxg-infinite-scroll-show-indicator="floorplanData.loading">
        <table class="table table-striped table-secondary">
          <thead>
            <th>Floored On</th>
            <th>Description</th>
            <th>Line of Credit</th>
            <th>Status</th>
          </thead>
          <tr ng-repeat="item in floorplanData.results">
            <td class="center">{{ item.FlooringDate | moment }}</td>
            <td class="table-value"><a href="#/vehicledetails?stockNumber={{ item.StockNumber }}">{{ item.Description }}</a></td>
            <td>{{ item.LineOfCredit }}</td>
            <td>{{ item.FloorplanStatusName }}</td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</section>
