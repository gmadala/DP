<div class="row-fluid">

  <!-- USER PROFILE -->
  <section class="span6 well settings-well" ng-controller="ProfileSettingsCtrl">
    <h2 class="well-title">User Profile
      <button ng-hide="profile.editable" class="btn edit-btn" ng-click="profile.edit()"><i class="glyphicon glyphicon-pencil"></i>Edit</button>
      <button ng-show="profile.editable" class="btn cancel-btn" ng-click="profile.cancel()">Cancel</button>
      <button ng-show="profile.editable" class="btn save-btn" ng-click="profile.save()">Save</button>
    </h2>

    <form class="form-block" ng-class="{ editable:profile.editable }" name="userSettings" novalidate>
      <div class="row-fluid">
        <label class="span4 " for="setUsername">User Name</label>
        <div class="span8" nxg-input model="profile.data.username" editable="profile.editable">
          <input type="text" name="setUsername" ng-model="profile.dirtyData.username" value="profile.dirtyData.username" ng-maxlength="40" ng-class="{ 'nxg-invalid': profile.validation.setUsername.$error.required || profile.validation.setUsername.$error.maxlength }" required/>
          <label for="setUsername" class="text-error"
             ng-show="profile.validation.setUsername.$error.required">
            Please enter a User Name.
          </label>
          <label for="setUsername" class="text-error"
                 ng-show="profile.validation.setUsername.$error.maxlength">
            Please enter a User Name that is 40 characters or less.
          </label>
        </div>
      </div>

      <div class="row-fluid">
        <label class="span4 " for="setPassword"><span ng-show="editable">New </span>Password</label>
        <div class="span8">
          <div class="static" ng-hide="profile.editable">***********</div>
          <div ng-show="profile.editable">
            <input type="password" name="setPassword" ng-model="profile.dirtyData.password" ng-class="{ 'nxg-invalid': profile.validation.setPassword.$error.pattern }" />
              <button class="btn-help"
                      id="password-help-tooltip"
                      tooltip-placement="right"
                      tooltip-trigger="click"
                      tooltip-html="true"
                      tooltip-html-unsafe="<h5>Password Reset</h5><p>Passwords must consist of a minimum of 8 characters.</p><p>Passwords must contain 3 of the 4 following types of characters: uppercase, lowercase, number, or special characters.</p>"
                      tooltip-animation="true"><span nxg-icon="icon-help"></span></button>
          </div>
          <label class="text-error" ng-show="profile.validation.setPassword.$error.pattern">
              Please enter a valid password.
          </label>
        </div>
      </div>

      <div class="row-fluid" ng-show="profile.editable">
        <label class="span4 " for="confirmPassword">Confirm Password</label>
        <div class="span8">
          <input type="password" id="confirmPassword" ng-model="profile.dirtyData.passwordConfirm" ng-class="{ 'nxg-invalid': profile.validation.setPassword.$error.nomatch }" />
          <label class="text-error" ng-show="profile.validation.setPassword.$error.nomatch">
            The passwords do not match. Please re-enter the password.
          </label>
        </div>
      </div>

      <div ng-repeat="question in profile.data.questions" ng-hide="profile.editable">
        <!-- Question Select -->
        <div class="row-fluid">
          <label class="span4 ">Security Question {{$index + 1}}</label>
          <div class="span8 static" ng-hide="profile.editable"> {{ question.QuestionText }} </div>
        </div>
      </div>

      <div ng-repeat="question in profile.dirtyData.questions" ng-show="profile.editable">
        <!-- Question Select -->
        <div class="row-fluid">
          <label class="span4 ">Security Question {{$index + 1}}</label>
          <div class="span8 style-select">
            <select ng-model="question.SecurityQuestionId"
                    ng-options="q.QuestionId as q.QuestionText for q in profile.data.allQuestions"
                    tooltip="{{ question.QuestionText }}"
                    tooltip-placement="right"
                    tooltip-popup-delay="700">
            </select>
          </div>
        </div>

        <!-- Answer -->
        <div class="row-fluid" ng-show="profile.editable">
          <label class="span4 " for="secAnswer">Answer</label>
          <div class="span8">
            <input type="text" name="secAnswer" ng-model="question.Answer" ng-class="{ 'nxg-invalid': question.$error.required || question.$error.maxLength }" required/>
            <label class="text-error" ng-show="question.$error.required">
              Please enter an Answer.
            </label>
            <label class="text-error" ng-show="question.$error.maxLength">
              Please enter an Answer that is a maximum of 100 characters.
            </label>
          </div>
        </div>
      </div>

      <div class="row-fluid">
        <label class="span4 " for="email">Email</label>
        <div class="span8" nxg-input model="profile.data.email" editable="profile.editable">
          <input type="email" name="email" ng-model="profile.dirtyData.email" value="profile.dirtyData.email" ng-class="{ 'nxg-invalid': profile.validation.email.$invalid }" required/>
          <label class="text-error" ng-show="profile.validation.email.$invalid">
            Please enter a valid email address.
          </label>
        </div>
      </div>

      <div class="row-fluid">
        <label class="span4 " for="phone">Phone</label>
        <div class="span8" nxg-input model="formatPhonenumber(profile.data.phone)" editable="profile.editable">
          <input type="tel"
                 name="phone"
                 ng-model="profile.dirtyData.phone"
                 ng-pattern="phonePattern"
                 size="10"
                 ng-class="{ 'nxg-invalid': profile.validation.phone.$error.pattern }" />
          <label class="text-error" ng-show="profile.validation.phone.$error.pattern">
              Please enter a valid phone number.
          </label>
        </div>
      </div>
    </form>
  </section>

  <!-- BUSINESS SETTINGS -->
  <section class="span6 well settings-well" novalidate ng-controller="AccountManagementCtrl">
    <h2 class="well-title">Business Settings
      <button ng-hide="business.editable" class="btn edit-btn" ng-click="business.edit()"><i class="glyphicon glyphicon-pencil"></i>Edit</button>
      <button ng-show="business.editable" class="btn cancel-btn" ng-click="business.cancel()">Cancel</button>
      <button ng-show="business.editable" class="btn save-btn" ng-click="business.save()">Save</button>
    </h2>

    <form class="form-block" ng-class="{ editable:business.editable }" name="busSettings">
      <div class="row-fluid">
        <label class="span4" for="businessEmail">Business Email</label>
        <div class="span8" nxg-input model="business.data.email" editable="business.editable">
          <input type="email" name="businessEmail" ng-model="business.dirtyData.email" value="business.dirtyData.email" ng-maxlength="100" ng-class="{ 'nxg-invalid': business.validation.businessEmail.$invalid }" required />
          <label class="text-error" ng-show="business.validation.businessEmail.$invalid">
              Please enter a valid email address.
          </label>
        </div>
      </div>

      <div class="row-fluid">
        <label class="span4" for="enhanced">Enhanced Registration Enabled?</label>
        <div class="span8">
          <!-- Show "Yes" if enhanced registration is enabled.
          If it is not enabled, show nothing. -->
          <div ng-show="business.data.enhancedRegistrationEnabled && !business.editable"> Yes </div>
          <div ng-show="!business.data.enhancedRegistrationEnabled && !business.editable"> No </div>

          <div class="cr-inline" ng-show="business.editable">
            <input type="radio" id="enhancedNo" name="enhanced" ng-model="business.dirtyData.enhancedRegistrationEnabled" ng-value='false' ng-click="business.confirmDisableEnhanced()"/>
            <label class="radio-img" for="enhancedNo"></label>
            <label class="cr-label" for="enhancedNo">No</label>
            <input type="radio" id="enhancedYes" name="enhanced" ng-model="business.dirtyData.enhancedRegistrationEnabled" ng-value='true' />
            <label class="radio-img" for="enhancedYes"></label>
            <label class="cr-label" for="enhancedYes">Yes</label>
          </div>
        </div>
      </div>

      <div class="row-fluid" ng-show="business.editable">
        <div class="span8 offset4">
          <p class="paragraph">Enhanced Registration will result in all account access being restricted to users with a PIN. All guarantors will be asked to set up their PIN when logging in to MyNextGear.</p>
          <p class="paragraph">Create your Enhanced Registration four digit PIN.</p>
        </div>
      </div>

      <div class="row-fluid" ng-show="business.editable">
        <label class="span4">Enhanced Registration PIN</label>
        <div class="span8">
          <input type="text"
                 id="pin"
                 name="pin"
                 ng-model="business.dirtyData.enhancedRegistrationPin"
                 ng-disabled="!business.dirtyData.enhancedRegistrationEnabled"
                 ng-pattern="/^\d{4}$/"
                 ng-required="business.dirtyData.enhancedRegistrationEnabled"
                 ng-class="{ 'nxg-invalid': business.validation.pin.$invalid }" />
          <label for="pin" class="text-error" ng-show="business.validation.pin.$invalid">
            Your PIN must consist of four numbers, no letters or special characters.
          </label>
        </div>
      </div>
    </form>
  </section>
</div>

<div class="row-fluid">
  <!-- TITLE SETTINGS -->
  <section class="span6 well settings-well" ng-controller="AccountManagementCtrl">
    <h2 class="well-title">Title Settings
      <button ng-hide="title.editable || title.data.addresses.length <= 1" class="btn edit-btn" ng-click="title.edit()"><i class="glyphicon glyphicon-pencil"></i>Edit</button>
      <button ng-show="title.editable" class="btn cancel-btn" ng-click="title.cancel()">Cancel</button>
      <button ng-show="title.editable" class="btn save-btn" ng-click="title.save()">Save</button>
    </h2>

    <form class="form-block" ng-class="{ editable:title.editable }" name="titleSettings">
      <div class="row-fluid">
        <label class="span4" for="titleAddr">Default Address:</label>
        <div class="span8">
          <div class="row-fluid" ng-show="title.editable">
            <div class="span9">
             <div class="style-select">
                <select ng-model="title.dirtyData.titleAddress"
                        ng-options="addr | address:'oneLineSelect' for addr in title.data.addresses"
                        tooltip="{{ addr | address:'oneLine' }}"
                        tooltip-placement="right"
                        tooltip-popup-delay="700">
                </select>
              </div>
            </div>
            <div class="span3">
              <button class="btn-help"
                tooltip-placement="right"
                tooltip-trigger="click"
                tooltip-html="true"
                tooltip-html-unsafe="To update or add a Title Settings address, please contact NextGear Capital at: {{customerSupportPhone}}"
                tooltip-animation="true">
                <span nxg-icon="icon-help"></span>
              </button>
            </div>
          </div>

          <!-- Saved Address -->
          <div class="row-fluid static" ng-hide="title.editable">
            <div class="span6">
              <div nxg-address="title.data.titleAddress"></div>
            </div>
            <div class="span6">
              <button class="btn-help"
                ng-show="title.data.addresses.length == 0"
                tooltip-placement="right"
                tooltip-trigger="click"
                tooltip-html="true"
                tooltip-html-unsafe="To update or add a Title Settings address, please contact NextGear Capital at: {{customerSupportPhone}}"
                tooltip-animation="true"><span nxg-icon="icon-help"></span></button>
            </div>
          </div>

          <!-- Current Address Selection-->
          <div class="static" ng-show="title.editable">
            <div nxg-address="title.dirtyData.titleAddress"></div>
          </div>
        </div>
      </div>

      <div class="row-fluid" ng-show="title.data.addresses && title.data.addresses.length > 0 && !title.editable">
        <label class="span4">Additional Addresses:</label>
        <div class="span8 static" ng-hide="title.editable">
          <ul ng-show="title.data.addresses.length > 0">
            <li class="alt-addr" ng-repeat="addr in title.data.addresses | limitTo: 3">
              <div nxg-address="addr"></div>
            </li>
            <li ng-show="title.data.extraAddresses">And {{ title.data.extraAddresses }} additional addresses...</li>
          </ul>
          <p ng-show="title.data.addresses.length == 0">
            None
          </p>
        </div>
      </div>
    </form>
  </section>

  <!-- NOTIFICATIONS -->
  <section class="span6 well settings-well" ng-controller="ProfileSettingsCtrl">
    <h2 class="well-title">Notifications
      <button ng-hide="notifications.editable" class="btn edit-btn" ng-click="notifications.edit()"><i class="glyphicon glyphicon-pencil"></i>Edit</button>
      <button ng-show="notifications.editable" class="btn cancel-btn" ng-click="notifications.cancel()">Cancel</button>
      <button ng-show="notifications.editable" class="btn save-btn" ng-click="notifications.save()">Save</button>
    </h2>

    <form class="form-block" ng-class="{ editable:notifications.editable }" name="notificationSettings">
      <div class="row-fluid">
        <h6 class="span4">Notifications</h6>
        <h6 class="span8" ng-hide="notifications.editable || notifications.data.selected.length == 0">Delivery Type</h6>
      </div>

      <ul>
        <li class="row-fluid" ng-repeat="n in notifications.data.selected" ng-hide="notifications.editable || notifications.data.selected.length == 0">
          <div class="span4">{{ n.NotificationName }}</div>

          <div class="span8">
            <p>
              <span ng-repeat="d in n.DeliveryMethods">
              {{ d.DeliveryMethodName }}<span ng-show="$index < n.DeliveryMethods.length - 1">, </span>
              </span>
            </p>
          </div>
        </li>
        <li ng-show="notifications.data.selected.length == 0 && !notifications.editable" >No notifications are currently enabled.</li>

        <!-- Edit -->
        <li class="row-fluid" ng-repeat="n in notifications.dirtyData.available" ng-show="notifications.editable">
          <div class="span4">{{ n.Name }}</div>
          <div class="span8 cr-inline">
            <span ng-repeat="d in n.DeliveryMethods">
              <input type="checkbox" id="{{ n.NotificationId + d.DeliveryMethodId }}" name="{{ d.Name }}" ng-model="d.Enabled" />
              <label class="checkbox-img small" for="{{ n.NotificationId + d.DeliveryMethodId }}"></label>
              <label class="cr-label" for="{{ n.NotificationId + d.DeliveryMethodId }}">{{ d.Name }}</label>
            </span>
          </div>
        </li>
      </ul>
    </form>
  </section>
</div>
