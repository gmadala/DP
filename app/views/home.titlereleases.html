<section class="row-fluid">
  <section class="span9">
    <div nxg-search
         title="Title Release Search"
         class="search-form"
         prompt="Stock #, VIN, Make, Model, or Year"
         metric-search="{{metric.CLICK_TITLE_RELEASE_SEARCH_BUTTON}}"
         metric-clear-search="{{metric.CLICK_TITLE_RELEASE_CLEAR_SEARCH_LINK}}"
         metric-filter-by-input="{{metric.CLICK_TITLE_RELEASE_FILTER_BY_INPUT}}"
         metric-filter-from-date="{{metric.CLICK_TITLE_RELEASE_FILTER_FROM_DATE_INPUT}}"
         metric-filter-to-date="{{metric.CLICK_TITLE_RELEASE_FILTER_TO_DATE_INPUT}}"
         filter-label="Filter by Status"
         filter-options="filterOptions"
         active-criteria="searchParams.proposedSearchCriteria"
         show-date-range="true"
         on-search="search()"
         on-clear="resetSearch()"
         filterable="true">
    </div>

    <div class="well" ng-switch="data.results.length > 0 || data.loading">
      <h2 class="well-title">Title Release Requests</h2>
      <p class="no-results" ng-switch-when="false">
        Sorry, no results found. Please <a ng-click="resetSearch()" title="New Search">try a new search</a>.
      </p>

      <div ng-switch-when="true"
           nxg-infinite-scroll="fetchNextResults()"
           nxg-infinite-scroll-disabled="data.loading"
           nxg-infinite-scroll-show-indicator="data.loading">
        <table class="table table-striped table-primary">
          <thead>
            <th class="sortable"
                ng-click="sortBy('FlooringDate')"
                ng-class="{ sorted : sortField == 'FlooringDate', desc : sortDescending }">
              Floored<span class="sortArrows"></span>
            </th>
            <th class="sortable"
                ng-click="sortBy('UnitMake')"
                ng-class="{ sorted : sortField == 'UnitMake', desc : sortDescending }">
              Description<span class="sortArrows"></span>
            </th>
            <th class="sortable"
                ng-click="sortBy('PurchaseDate')"
                ng-class="{ sorted : sortField == 'PurchaseDate', desc : sortDescending }">
              Purchased<span class="sortArrows"></span>
            </th>
            <th class="sortable"
                ng-click="sortBy('TitleReleaseProgramStatus')"
                ng-class="{ sorted : sortField == 'TitleReleaseProgramStatus', desc : sortDescending }">
              Release Status<span class="sortArrows"></span>
            </th>
            <th>Actions</th>
          </thead>
          <tr ng-repeat="item in data.results">

            <td>
              <p class="lockup-major">{{ item.FlooringDate | moment}}</p>
              <p class="lockup-minor">{{ item.DaysFloored }} days</p>
            </td>
            <td class="description">
              <a class="lockup-major" href="#/vehicledetails?stockNumber={{ item.StockNumber }}" nxg-track="{{metric.CLICK_TITLE_RELEASE_VEHICLE_DETAILS}}" nxg-highlight="getVehicleDescription(item)" highlight="item.data.query"></a>
              <div class="row-fluid">
                <p class="lockup-minor caps vin">VIN: <span nxg-highlight="item.UnitVIN" highlight="item.data.query" class="break-word"></span></p>
                <p class="lockup-minor caps stock">STK: <span nxg-highlight="item.StockNumber" highlight="item.data.query"></span></p>
              </div>
            </td>
            <td class="date">
              <p>{{item.UnitPurchaseDate | moment}}</p>
            </td>
            <td ng-switch="item.TitleReleaseProgramStatus">
              <p ng-switch-when="OutstandingTitleReleaseProgramRelease">Title Released on {{item.TitleReleaseDate | moment}}</p>
              <p ng-switch-when="EligibleForRelease">Eligible for Title Release</p>
              <p ng-switch-when="NotEligibleForRelease">Not Eligible for Title Release</p>
            </td>
            <td class="actions" ng-switch="item.TitleReleaseProgramStatus">
              <h6 ng-switch-when="OutstandingTitleReleaseProgramRelease">Pay off this vehicle or return the title to remove from your limit.</h6>
              <div ng-switch-when="EligibleForRelease">
                <button type="button" class="btn btn-icon" ng-click="toggleSelected(item)" ng-switch="isFloorplanOnQueue(item)" ng-class="{selected: isFloorplanOnQueue(item)}" ng-disabled="$parent.eligibilityLoading() || (!isFloorplanOnQueue(item) && $parent.eligibility.RemainingReleasesAvailable <= $parent.queueLength())">
                  <span ng-switch-when="true" nxg-track="{{metric.CLICK_TITLE_RELEASE_TITLE_REQUESTED}}">
                    Title Requested<span nxg-icon="icon-minus" class="icon-small"></span>
                  </span>
                  <span ng-switch-default nxg-track="{{metric.CLICK_TITLE_RELEASE_REQUEST_TITLE}}">
                    Request Title<span nxg-icon="icon-plus" class="icon-small"></span>
                  </span>
                </button>
              </div>
              <a ng-switch-when="NotEligibleForRelease" ng-click="titleReleaseUnavailable()" nxg-track="{{metric.CLICK_TITLE_RELEASE_UNAVAILABLE}}">
                Title Release Unavailable
              </a>
            </td>
          </tr>
        </table>
      </div>

      <p class="text-error notice-box" ng-show="data.hitInfiniteScrollMax">
        There are too many results to display, please refine your search further.
      </p>
    </div>
  </section>
  <section class="span3 well request-queue sticky" nxg-requests-summary eligibility="eligibility" nxg-sticky></section>
</section>
