<div class="modal-header">
  <h3>Business Search</h3>
</div>

<div class="modal-close" ng-disabled="submitInProgress" ng-click="close()">
  <span class="glyphicon glyphicon-remove"></span>
</div>

<div class="modal-body search-controls">
  <div class="control-group shorten">
    <label class="control-label">City</label>
    <div class="controls">
      <input type="text" ng-model="proposedQuery.city">
    </div>
  </div>
  <div class="control-group shorten">
    <label class="control-label">State</label>
    <div class="controls">
      <select id="state" ng-model="proposedQuery.state" ng-options="state.StateName for state in states">
        <option value=""></option>
      </select>
    </div>
  </div>

  <div class="control-group">
    <label class="control-label">Business Name</label>
    <div class="controls">
      <input type="text" ng-model="proposedQuery.name">
      <button class="btn btn-secondary nxg-search-btn" ng-click="search()">
        <i class="glyphicon glyphicon-search"></i>
      </button>
    </div>
  </div>
</div>

<div ng-switch="data.results.length > 0 || data.loading">
  <p class="no-results" ng-switch-when="false" ng-switch="!isQueryValid(data.query)">
    <span ng-switch-when="false">Sorry, no results found. Please try a new search.</span>
    <span ng-switch-when="true">Please enter a name, and city or state, to search.</span>
  </p>

  <div class="modal-body search-results" ng-switch-when="true"
     nxg-infinite-scroll="fetchNextResults()"
     nxg-infinite-scroll-disabled="data.loading"
     nxg-infinite-scroll-show-indicator="data.loading"
     nxg-scroll-container>
    <table>
      <thead>
      <tr>
        <th ng-click="sortBy('BusinessName')" class="sortable"
            ng-class="{ sorted : data.sortBy == 'BusinessName', desc : data.sortDescending }">
          Business Name
        </th>
        <th ng-click="sortBy('BusinessLegalName')" class="sortable"
            ng-class="{ sorted : data.sortBy == 'BusinessLegalName', desc : data.sortDescending }">
          Legal Name
        </th>
        <th ng-click="sortBy('BusinessNumber')" class="sortable"
            ng-class="{ sorted : data.sortBy == 'BusinessNumber', desc : data.sortDescending }">
          Business&nbsp;#
        </th>
        <th ng-click="sortBy('City')" class="sortable"
            ng-class="{ sorted : data.sortBy == 'City', desc : data.sortDescending }">
          City
        </th>
        <th ng-click="sortBy('State')" class="sortable"
            ng-class="{ sorted : data.sortBy == 'State', desc : data.sortDescending }">
          State
        </th>
        <th></th>
      </tr>
      </thead>
      <tbody>
        <tr ng-repeat="business in data.results">
            <td>{{ business.BusinessName }}</td>
            <td>{{ business.BusinessLegalName }}</td>
            <td>{{ business.BusinessNumber }}</td>
            <td>{{ business.City }}</td>
            <td>{{ business.State }}</td>
            <td><a href class="btn btn-mini" ng-click="showCreditQuery(business)">Query</a></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="modal-footer">
  <button ng-click="close()" class="btn btn-mini btn-secondary" >Cancel</button>
</div>
