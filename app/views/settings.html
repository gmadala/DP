<div class="container-line">
  <div class="container-fluid settings">
    <div class="row-fluid two-col">

      <section class="span8 well adjacent">
        <h4>User Profile</h4>
        <button ng-hide="profile.editable" class="btn edit-btn" ng-click="profile.edit()"><i class="glyphicon glyphicon-pencil"></i>Edit</button>
        <button ng-show="profile.editable" class="btn cancel-btn" ng-click="cancel()">Cancel</button>
        <button ng-show="profile.editable" class="btn save-btn" ng-click="save()">Save</button>

        <div class="well-out">
          <form class="settings-opts" ng-class="{ profile.editable: editable }" name="userSettings" novalidate>

            <div class="control-group">
              <label class="control-label" for="setUsername">User Name</label>
              <div class="controls" nxg-input model="profile.data.username" editable="profile.editable">
                <input type="text" id="setUsername" ng-model="profile.username" value="profile.username" required/>
              </div>
            </div>

            <div class="control-group">
              <label class="control-label" for="setPassword"><span ng-show="editable">New </span>Password</label>
              <div class="static" ng-hide="profile.editable">***********</div>
              <div class="controls" nxg-input model="profile.data.password" editable="profile.editable">
                <input type="password" name="setPassword" id="setPassword" ng-model="profile.data.password" required/><button class="btn-help" tooltip="Info about the password field." tooltip-placement="right" tooltip-title="Password Reset" popover-animation="true">?</button>
              </div>
            </div>

            <div class="control-group" ng-show="profile.editable">
              <label class="control-label" for="confirmPassword">Confirm Password</label>
              <div class="controls">
                <input type="password" id="confirmPassword" ng-model="profile.passwordConfirm" required />
                <p class="form-error" ng-show="">
                  The passwords do not match. Please re-enter the password.
                </p>
              </div>
            </div>

            <div ng-repeat="question in profile.data.questions">
                <!-- Question Select -->
                <div class="control-group">
                  <label class="control-label">Security Question {{$index}}</label>
                  <div class="controls" nxg-input model="question.QuestionText" editable="profile.editable">
                    <select ng-model="question.SecurityQuestionId"
                            ng-options="q.QuestionId as q.QuestionText for q in profile.data.allQuestions"
                            tooltip="{{ question.QuestionText }}"
                            tooltip-placement="right"
                            tooltip-popup-delay="700">
                    </select>
                  </div>
                </div>
                <!-- Answer -->
                <div class="control-group" ng-show="profile.editable">
                    <label class="control-label" for="secAnswer">Answer</label>
                    <div class="controls">
                        <input type="text" id="secAnswer" ng-model="question.Answer" />
                    </div>
                </div>
            </div>

            <div class="control-group">
              <label class="control-label" for="email">Email</label>
              <div class="controls" nxg-input model="profile.data.email" editable="profile.editable">
                <input type="email" name="email" id="email" ng-model="profile.data.email" value="profile.data.email" required/>
                <p class="form-error" ng-show="userSettings.email.$invalid && userSettings.email.$dirty">
                  Please enter a valid email address.
                </p>
              </div>
            </div>

            <div class="control-group">
              <label class="control-label" for="phone">Phone</label>
              <div class="controls" nxg-input model="formatPhonenumber(profile.data.phone)" editable="profile.editable">
                <input type="tel" id="phone" ng-model="profile.data.phone" value="profile.data.phone" required/>
              </div>
            </div>

          </form>
        </div><!-- end .well-out -->
      </section><!-- end .span8.well.adjacent -->


      <section class="span8 well adjacent" novalidate>
        <h4>Business Settings</h4>
        <button ng-hide="editable" class="btn edit-btn" ng-click="makeEditable()"><i class="glyphicon glyphicon-pencil"></i>Edit</button>
        <button ng-show="editable" class="btn cancel-btn" ng-click="cancel()">Cancel</button>
        <button ng-show="editable" class="btn save-btn" ng-click="save()">Save</button>

        <div class="well-out">
          <form class="settings-opts" ng-class="{editable: editable }" name="busSettings">
            <div class="control-group">
              <label class="control-label" for="businessEmail">Business Email</label>
              <div class="controls" nxg-input model="business.email" editable="editable">
                <input type="email" id="businessEmail" name="businessEmail" ng-model="business.email" value="business.email" required />
                <p class="form-error" ng-show="busSettings.businessEmail.$error.email">
                  XXXX@email.m is not a valid email address.
                </p>
              </div>
            </div>

            <div class="control-group">
              <label class="control-label" for="enhanced">Enhanced Registration Enabled?</label>

              <!-- Show "Yes" if enhanced registration is enabled.
              If it is not enabled, show nothing. -->
              <div class="controls" ng-show="business.enhanced && !editable">
                Yes
              </div>

              <div class="controls form-inline nxg-radios" ng-show="editable">
                <!-- TODO: Add modal if enhanced registration is turned off in the form. -->
                <input type="radio" id="enhancedNo" name="enhanced" ng-model="business.enhanced" ng-value='false'/><label for="enhancedNo">No</label>
                <input type="radio" id="enhancedYes" name="enhanced" ng-model="business.enhanced" ng-value='true' /> <label for="enhancedYes">Yes</label>

                <p>Enhanced Registration will result in all account access being restricted to users with a PIN.</p>
                <p>All guarantors will be asked to set up their PIN when logging in to MyNextGear.</p>
                <p>Create your Enhanced Registration four digit PIN.</p>
              </div>
            </div>

            <div class="control-group" ng-show="editable">
              <label class="control-label">Enhanced Registration PIN</label>

              <div class="controls">
                <input type="text" name="pin" ng-model="business.pin" ng-disable="business.enhanced" ng-pattern="/^[0-9]+$/" ng-minlength=4 required />
                <p class="form-error" ng-show="busSettings.pin.$error.minlength">
                  Your PIN must consist of four numbers.
                </p>
                <p class="form-error" ng-show="busSettings.pin.$error.pattern">
                  Your PIN must contain only numbers, no letters or special characters.
                </p>
              </div>
            </div>

          </form>
        </div><!-- end .well-out -->
      </section><!-- end .span8.well.adjacent -->
    </div><!-- end .row-fluid.two-col -->

    <div class="row-fluid two-col">
      <section class="span8 well adjacent">
        <h4>Title Settings</h4>
        <button ng-hide="editable" class="btn edit-btn" ng-click="makeEditable()"><i class="glyphicon glyphicon-pencil"></i>Edit</button>
        <button ng-show="editable" class="btn cancel-btn" ng-click="cancel()">Cancel</button>
        <button ng-show="editable" class="btn save-btn" ng-click="save()">Save</button>

        <div class="well-out">
          <form class="settings-opts" ng-class="{ editable: editable }"name="titleSettings">
            <div class="control-group">

              <label class="control-label" for="titleAddr">Address</label>
              <div class="controls" nxg-input model="title.address" editable="editable">
                <select ng-model="title.address" required>
                  <option>foo</option>
                </select>

                <button class="btn-help" tooltip="To update or add a Title Settings address, please contact NextGear at: (800) 555-5555" tooltip-placement="right" tooltip-animation="true" class="btn">?</button>
              </div>
            </div>
          </form>
        </div><!-- end .well-out -->
      </section><!-- end .span8.well.adjacent -->

      <section class="span8 well adjacent">
        <!-- SEE NOTE IN TICKETS #15 & #17 -->
        <h4>Notifications</h4>
        <button ng-hide="editable" class="btn edit-btn" ng-click="makeEditable()"><i class="glyphicon glyphicon-pencil"></i>Edit</button>
        <button ng-show="editable" class="btn cancel-btn" ng-click="cancel()">Cancel</button>
        <button ng-show="editable" class="btn save-btn" ng-click="save()">Save</button>

        <div class="well-out">
          <form class="settings-opts" ng-class="{ editable: editable }" name="notificationSettings">
            <div class="head-labels">
              <label>Notifications</label>
              <label ng-hide="editable">Delivery Type</label>
            </div>

            <div class="control-group">
              <div class="controls notifications">
                <ul class="unstyled">
                  <li class="notification" ng-repeat="n in notifications">
                    <div class="n-title">{{ n.title }}</div>
                    <ul class="inner">
                      <li class="read-only" ng-repeat="t in n.types" ng-show="!editable && t.on">
                        {{ t.type }}
                      </li>

                      <!-- TODO: Fix this as part of MVC Ticket -->
                      <li ng-repeat="t in n.types" ng-show="editable">
                        <input type="checkbox" name="{{ t.type }}" id="{{ t.type }}" ng-model="t.on" ng-value="t.on" />
                        <label for="{{ t.type }}">{{ t.type }}</label>
                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
            </div>
          </form>
        </div>
      </section><!-- end .span8.well.adjacent -->
    </div><!-- end .row-fluid.two-col -->
  </div><!-- end .container-fluid.settings -->
</div><!-- end .container-line -->
