<div class="row-fluid">

  <!-- BUSINESS SETTINGS -->
  <section class="span6 well settings-well" novalidate>
    <h2 class="well-title">
      <span translate>Business Settings</span>
      <button ng-hide="business.editable" class="btn cta-secondary" ng-click="business.edit()"><i class="glyphicon glyphicon-pencil"></i><span translate>Edit</span></button>
      <button ng-show="business.editable" class="btn cta-secondary" ng-click="business.cancel()" translate>Cancel</button>
      <button ng-show="business.editable" class="btn cta-secondary" ng-click="business.save()" translate>Save</button>
    </h2>

    <form class="form-block" ng-class="{ editable:business.editable }" name="busSettings">
      <div class="row-fluid">
        <label class="span4" for="businessEmail" translate>Business Email</label>
        <div class="span8" nxg-input model="business.data.email" editable="business.editable">
          <input type="email" name="businessEmail" ng-model="business.dirtyData.email" value="business.dirtyData.email" ng-maxlength="100" ng-class="{ 'nxg-invalid': business.validation.businessEmail.$invalid }" required />
          <label class="text-error" ng-show="business.validation.businessEmail.$invalid" translate>
              Please enter a valid email address.
          </label>
        </div>
      </div>

      <div class="row-fluid">
        <label class="span4" for="enhanced" translate>Enhanced Registration Enabled?</label>

        <div class="span8">
          <div ng-show="business.data.enhancedRegistrationEnabled && !business.editable" translate> Yes </div>
          <!-- check if equal to false so "No" doesn't appear until the API call finishes -->
          <div class="" ng-show="business.data.enhancedRegistrationEnabled == false && !business.editable" translate> No </div>

          <div class="cr-inline" ng-show="business.editable">
            <input type="radio" id="enhancedNo" name="enhanced" ng-model="business.dirtyData.enhancedRegistrationEnabled" ng-value='false' ng-click="business.confirmDisableEnhanced()"/>
            <label class="radio-img" for="enhancedNo"></label>
            <label class="cr-label" for="enhancedNo" translate>No</label>

            <input type="radio" id="enhancedYes" name="enhanced" ng-model="business.dirtyData.enhancedRegistrationEnabled" ng-value='true' />
            <label class="radio-img" for="enhancedYes"></label>
            <label class="cr-label" for="enhancedYes" translate>Yes</label>
          </div>
        </div>
      </div>

      <div class="row-fluid" ng-show="business.editable">
        <div class="span8 offset4">
          <p class="paragraph" translate>Enhanced Registration will result in all account access being restricted to users with a PIN. All guarantors will be asked to set up their PIN when logging in to MyNextGear.</p>
          <p class="paragraph" translate>Create your Enhanced Registration four digit PIN.</p>
        </div>
      </div>

      <div class="row-fluid" ng-show="business.editable">
        <label class="span4" translate>Enhanced Registration PIN</label>

        <div class="span8">
          <input type="text"
                 name="pin"
                 id="pin"
                 ng-model="business.dirtyData.enhancedRegistrationPin"
                 ng-disabled="!business.dirtyData.enhancedRegistrationEnabled"
                 ng-pattern="/^\d{4}$/"
                 ng-required="business.dirtyData.enhancedRegistrationEnabled"
                 ng-class="{ 'nxg-invalid': business.validation.pin.$invalid }" />
          <label for="pin" class="text-error" ng-show="business.validation.pin.$invalid" translate>
            Your PIN must consist of four numbers, no letters or special characters.
          </label>
        </div>
      </div>
    </form>
  </section>

  <!-- TITLE SETTINGS -->
  <section class="span6 well settings-well">
    <h2 class="well-title">
      <span translate>Title Settings</span>
      <button ng-show="!title.editable && title.data.addressCount > 1" class="btn cta-secondary" ng-click="title.edit()"><i class="glyphicon glyphicon-pencil"></i><span translate>Edit</span></button>
      <button ng-show="title.editable" class="btn cta-secondary" ng-click="title.cancel()" translate>Cancel</button>
      <button ng-show="title.editable" class="btn cta-secondary" ng-click="title.save()" translate>Save</button>
    </h2>

    <form class="form-block" ng-class="{ editable:title.editable }" name="titleSettings">
      <div class="row-fluid">
        <label class="span4" for="titleAddr"><span translate>Default Address</span>:</label>
        <div class="span8">
          <div class="row-fluid" ng-show="title.editable">
            <div class="span9">
              <div class="style-select">
                <select ng-model="title.dirtyData.titleAddress"
                        ng-options="addr | address:'oneLineSelect' for addr in title.data.addresses"
                        tooltip="{{ addr | address:'oneLine' }}"
                        tooltip-placement="right"
                        tooltip-popup-delay="700">
                </select>
              </div>
            </div>
            <div class="span3">
              <button class="btn-help"
                tooltip-placement="right"
                tooltip-trigger="focus"
                tooltip-html="true"
                tooltip-html-unsafe="{{ 'To update or add a Title Settings address, please contact NextGear Capital at: ' + customerSupportPhone + '.' | translate }}"
                tooltip-animation="true">
                <span nxg-icon="icon-help"></span>
              </button>
            </div>
          </div>

          <!-- Saved Address -->
          <div class="row-fluid static" ng-hide="title.editable">
            <div class="span6">
              <div nxg-address="title.data.titleAddress"></div>
            </div>
            <div class="span6">
              <button class="btn-help" ng-show="title.data.addresses.length == 0"
                tooltip-placement="right"
                tooltip-trigger="focus"
                tooltip-html="true"
                tooltip-html-unsafe="{{ 'To update or add a Title Settings address, please contact NextGear Capital at: ' + customerSupportPhone + '.' | translate }}"
                tooltip-animation="true">
                <span nxg-icon="icon-help"></span>
              </button>
            </div>
          </div>

          <!-- Current Address Selection-->
          <div class="static" ng-show="title.editable">
            <div nxg-address="title.dirtyData.titleAddress"></div>
          </div>
        </div>
      </div>

      <div class="row-fluid" ng-show="title.data.addresses && title.data.addresses.length > 0 && !title.editable">
        <label class="span4"><span translate>Additional Addresses</span>:</label>
        <div class="span8 static" ng-hide="title.editable">
          <ul>
            <li class="alt-addr" ng-repeat="addr in title.data.addresses | limitTo: 3">
              <div nxg-address="addr"></div>
            </li>
            <li ng-show="title.data.extraAddresses" translate>And {{ title.data.extraAddresses }} additional addresses...</li>
          </ul>
          <p ng-show="title.data.addresses.length == 0" translate>
            None
          </p>
        </div>
      </div>
    </form>
  </section>
</div>

<div class="row-fluid">
  <!-- FINANCIAL ACCOUNTS -->
  <section class="span6 well settings-well">
    <h2 class="well-title" translate>Financial Accounts</h2>

    <form class="form-block" name="financialSettings" novalidate>
      <div class="row-fluid">
        <label class="span4" for="setBankAcct"><span translate>Bank Account(s)</span>:</label>
        <div class="span8">
          <ul>
            <li ng-repeat="acct in financial.data.bankAccounts">{{ acct.BankAccountName }}</li>
          </ul>
        </div>
      </div>

      <div class="row-fluid">
        <label class="span4"><span translate>Available Credit</span>:</label>
        <div class="span8 static">{{ financial.data.availableCredit | currency }}</div>
      </div>

      <div class="row-fluid">
        <label class="span4"><span translate>Reserve Funds</span>:</label>
        <div class="span8 static">{{ financial.data.reserveFunds || 0 | currency }}</div>
      </div>

      <div class="row-fluid">
        <label class="span4"><span translate>Last Payment</span>:</label>
        <div class="span8 static">{{ financial.data.lastPayment.amount | currency }}</div>
      </div>

      <div class="row-fluid">
        <label class="span4"><span translate>Last Payment Date</span>:</label>
        <div class="span8 static">{{ financial.data.lastPayment.date | moment }}</div>
      </div>

      <div class="row-fluid">
        <label class="span4"><span translate>Unapplied Funds</span>:</label>
        <div class="span8 static">{{ financial.data.unappliedFunds | currency }}</div>
      </div>

      <div class="row-fluid">
        <label class="span4"><span translate>Total Available</span>:</label>
        <div class="span8 static">{{ financial.data.totalAvailable | currency }}</div>
      </div>

      <div ng-show="financial.data.autoDisburseUnappliedFunds" class="row-fluid">
        <label class="span4"><span translate>Auto-Disburse Unapplied Funds</span>:</label>
        <div class="span8 static">
          <span ng-show="financial.data.autoDisburseUnappliedFunds" translate>Enabled</span>
          <span ng-show="!financial.data.autoDisburseUnappliedFunds" translate>Disabled</span>
        </div>
      </div>
    </form>
  </section>

  <!-- SELF-SERVICE LINKS -->
  <section class="span6 well settings-well">
    <h2 class="well-title" translate>Self-Service Links</h2>

    <div class="row-fluid form-block">
      <!-- CREDIT INCREASE -->
      <div class="span6">
        <p><a href="javascript:void(0)" ng-click="onRequestCredIncr()" translate>Request a Credit Increase</a><br/>
        <span translate>Initiate your request for a permanent or temporary increase to your current line of credit.</span></p>
      </div>

      <!-- GO FINANCIAL -->
      <div class="span6">
        <p>
          <a href="https://www.gofinancial.com/Dealer" target="_blank" translate>Login to GO Financial</a><br/>
          <span translate>Access your GO Financial account directly from here.</span>
        </p>
      </div>
    </div>
  </section>
</div>
