<div class="row-fluid">

  <!-- BUSINESS SETTINGS -->
  <section class="span6 well settings-well" novalidate>
    <h2 class="well-title">
      Business Settings
      <div class="well-sub-title">
        <button ng-hide="business.editable" class="btn-unstyle" ng-click="business.edit()">Edit Settings</button>
        <button ng-show="business.editable" class="btn-unstyle" ng-click="business.save()">Save Settings</button>
        <button ng-show="business.editable" class="btn-unstyle cancel" ng-click="business.cancel()">Cancel Changes</button>
      </div>
    </h2>

    <form class="form-block" ng-class="{ editable:business.editable }" name="busSettings">
      <div class="row-fluid">
        <label class="span4" for="businessEmail">Business Email</label>
        <div class="span8" nxg-input model="business.data.email" editable="business.editable">
          <input type="email" name="businessEmail" ng-model="business.dirtyData.email" value="business.dirtyData.email" ng-maxlength="100" ng-class="{ 'nxg-invalid': business.validation.businessEmail.$invalid }" required />
          <label class="text-error" ng-show="business.validation.businessEmail.$invalid">
              Please enter a valid email address.
          </label>
        </div>
      </div>

      <div class="row-fluid">
        <label class="span4" for="enhanced">Enhanced Registration Enabled?</label>

        <div class="span8">
          <div class="static" ng-show="business.data.enhancedRegistrationEnabled && !business.editable"> Yes </div>
          <!-- check if equal to false so "No" doesn't appear until the API call finishes -->
          <div class="static" ng-show="business.data.enhancedRegistrationEnabled == false && !business.editable"> No </div>

          <div class="cr-inline" ng-show="business.editable">
            <input type="radio" id="enhancedNo" name="enhanced" ng-model="business.dirtyData.enhancedRegistrationEnabled" ng-value='false' ng-click="business.confirmDisableEnhanced()"/>
            <label class="radio-img" for="enhancedNo"></label>
            <label class="cr-label" for="enhancedNo">No</label>

            <input type="radio" id="enhancedYes" name="enhanced" ng-model="business.dirtyData.enhancedRegistrationEnabled" ng-value='true' />
            <label class="radio-img" for="enhancedYes"></label>
            <label class="cr-label" for="enhancedYes">Yes</label>
          </div>
        </div>
      </div>

      <div class="row-fluid" ng-show="business.editable">
        <div class="span8 offset4">
          <p class="paragraph">Enhanced Registration will result in all account access being restricted to users with a PIN. All guarantors will be asked to set up their PIN when logging in to MyNextGear.</p>
          <p class="paragraph">Create your Enhanced Registration four digit PIN.</p>
        </div>
      </div>

      <div class="row-fluid" ng-show="business.editable">
        <label class="span4">Enhanced Registration PIN</label>

        <div class="span8">
          <input type="text"
                 name="pin"
                 id="pin"
                 ng-model="business.dirtyData.enhancedRegistrationPin"
                 ng-disabled="!business.dirtyData.enhancedRegistrationEnabled"
                 ng-pattern="/^\d{4}$/"
                 ng-required="business.dirtyData.enhancedRegistrationEnabled"
                 ng-class="{ 'nxg-invalid': business.validation.pin.$invalid }" />
          <label for="pin" class="text-error" ng-show="business.validation.pin.$invalid">
            Your PIN must consist of four numbers, no letters or special characters.
          </label>
        </div>
      </div>
    </form>
  </section>

  <!-- TITLE SETTINGS -->
  <section class="span6 well settings-well">
    <h2 class="well-title">
      Title Settings
      <div class="well-sub-title">
        <button ng-show="!title.editable && title.data.addressCount > 1" class="btn-unstyle" ng-click="title.edit()">Edit Settings</button>
        <button ng-show="title.editable" class="btn-unstyle" ng-click="title.save()">Save Settings</button>
        <button ng-show="title.editable" class="btn-unstyle cancel" ng-click="title.cancel()">Cancel Changes</button>
      </div>
    </h2>

    <form class="form-block" ng-class="{ editable:title.editable }" name="titleSettings">
      <div class="row-fluid">
        <label class="span4" for="titleAddr">Default Address:</label>
        <div class="span8">
          <div class="row-fluid" ng-show="title.editable">
            <div class="span9">
              <div class="style-select">
                <select ng-model="title.dirtyData.titleAddress"
                        ng-options="addr | address:'oneLineSelect' for addr in title.data.addresses"
                        tooltip="{{ addr | address:'oneLine' }}"
                        tooltip-placement="right"
                        tooltip-popup-delay="700">
                </select>
              </div>
            </div>
            <div class="span3">
              <button class="btn-help"
                tooltip-placement="right"
                tooltip-trigger="focus"
                tooltip-html="true"
                tooltip-html-unsafe="To update or add a Title Settings address, please contact NextGear Capital at: {{customerSupportPhone}}."
                tooltip-animation="true">
                <span nxg-icon="icon-help"></span>
              </button>
            </div>
          </div>

          <!-- Saved Address -->
          <div class="row-fluid static" ng-hide="title.editable">
            <div class="span6">
              <div nxg-address="title.data.titleAddress"></div>
            </div>
            <div class="span6">
              <button class="btn-help"
                tooltip-placement="right"
                tooltip-trigger="focus"
                tooltip-html="true"
                tooltip-html-unsafe="To update or add a Title Settings address, please contact NextGear Capital at: {{customerSupportPhone}}."
                tooltip-animation="true">
                <span nxg-icon="icon-help"></span>
              </button>
            </div>
          </div>

          <!-- Current Address Selection-->
          <div class="static" ng-show="title.editable">
            <div nxg-address="title.dirtyData.titleAddress"></div>
          </div>
        </div>
      </div>

      <div class="row-fluid" ng-show="title.data.addresses && title.data.addresses.length > 0 && !title.editable">
        <label class="span4">Additional Addresses:</label>
        <div class="span8 static" ng-hide="title.editable">
          <ul>
            <li class="alt-addr" ng-repeat="addr in title.data.addresses | limitTo: 3">
              <div nxg-address="addr"></div>
            </li>
            <li ng-show="title.data.extraAddresses">And {{ title.data.extraAddresses }} additional addresses...</li>
          </ul>
          <p ng-show="title.data.addresses.length == 0">
            None
          </p>
        </div>
      </div>
    </form>
  </section>
</div>

<div class="row-fluid">
  <!-- FINANCIAL ACCOUNTS -->
  <section class="span6 well settings-well">
    <h2 class="well-title">Financial Accounts</h2>

    <form class="form-block" name="financialSettings" novalidate>
      <div class="row-fluid">
        <label class="span4" for="setBankAcct">Bank Account(s):</label>
        <div class="span8">
          <ul>
            <li ng-repeat="acct in financial.data.bankAccounts">{{ acct.BankAccountName }}</li>
          </ul>
        </div>
      </div>

      <div class="row-fluid">
        <label class="span4">Available Credit:</label>
        <div class="span8 static">{{ financial.data.availableCredit | currency }}</div>
      </div>

      <div class="row-fluid">
        <label class="span4">Reserve Funds:</label>
        <div class="span8 static">{{ financial.data.reserveFunds || 0 | currency }}</div>
      </div>

      <div class="row-fluid">
        <label class="span4">Last Payment:</label>
        <div class="span8 static">{{ financial.data.lastPayment.amount | currency }}</div>
      </div>

      <div class="row-fluid">
        <label class="span4">Last Payment Date:</label>
        <div class="span8 static">{{ financial.data.lastPayment.date | moment }}</div>
      </div>

      <div class="row-fluid">
        <label class="span4">Unapplied Funds:</label>
        <div class="span8 static">{{ financial.data.unappliedFunds | currency }}</div>
      </div>

      <div class="row-fluid">
        <label class="span4">Total Available:</label>
        <div class="span8 static">{{ financial.data.totalAvailable | currency }}</div>
      </div>

      <div ng-show="financial.data.autoDisburseUnappliedFunds" class="row-fluid">
        <label class="span4">Auto-Disburse Unapplied Funds:</label>
        <div class="span8 static">{{ { true: 'Enabled', false: 'Disabled' }[financial.data.autoDisburseUnappliedFunds] }}</div>
      </div>
    </form>
  </section>

  <!-- SELF-SERVICE LINKS -->
  <section class="span6 well settings-well">
    <h2 class="well-title">Self-Service Links</h2>

    <div class="row-fluid form-block">
      <!-- CREDIT INCREASE -->
      <div class="span6">
        <p><a href="javascript:void(0)" ng-click="onRequestCredIncr()">Request a Credit Increase</a><br/>
        Initiate your request for a permanent or temporary increase to your current line of credit.</p>
      </div>

      <!-- GO FINANCIAL -->
      <div class="span6">
        <p>
          <a href="https://www.gofinancial.com/Dealer" target="_blank">Login to GO Financial</a><br/>
          Access your GO Financial account directly from here.
        </p>
      </div>
    </div>
  </section>
</div>
