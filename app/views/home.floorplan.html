<section class="row-fluid">
  <section class="span12">
    <div nxg-search
      title="Find a Floor Plan"
      class="search-form"
      prompt="Stock #, VIN, Make, Model, or Year"
      metric-search="{{metric.CLICK_FLOORPLAN_SEARCH_BUTTON}}"
      metric-clear-search="{{metric.CLICK_FLOORPLAN_PAYMENTS_CLEAR_SEARCH_LINK}}"
      metric-filter-by-input="{{metric.CLICK_FLOORPLAN_FILTER_BY_INPUT}}"
      metric-filter-from-date="{{metric.CLICK_FLOORPLAN_FILTER_FROM_DATE_INPUT}}"
      metric-filter-to-date="{{metric.CLICK_FLOORPLAN_FILTER_TO_DATE_INPUT}}"
      metric-filter-by-inventory-location="{{metric.CLICK_FLOORPLAN_FILTER_BY_INVENTORY_LOCATION}}"
      filter-label="Filter by Flooring Status"
      filter-options="filterOptions"
      active-criteria="proposedSearchCriteria"
      on-search="search()"
      on-clear="resetSearch()"
      filterable="true"
      show-location-filter="true">
    </div>

    <div class="well" ng-switch="data.results.length > 0 || data.loading">
      <h2 class="well-title">Floor Plan</h2>
      <p class="no-results" ng-switch-when="false">
        Sorry, no results found. Please <a ng-click="resetSearch()" title="New Search">try a new search</a>.
      </p>

      <div ng-switch-when="true"
               nxg-infinite-scroll="fetchNextResults()"
               nxg-infinite-scroll-disabled="data.loading"
               nxg-infinite-scroll-show-indicator="data.loading">
        <table class="table table-striped table-primary">
          <thead>
            <th class="sortable"
                ng-click="sortBy('FlooringDate')"
                ng-class="{ sorted : sortField == 'FlooringDate', desc : sortDescending }">
              Floored<span class="sortArrows"></span>
            </th>
            <th class="sortable"
                ng-click="sortBy('UnitMake')"
                ng-class="{ sorted : sortField == 'UnitMake', desc : sortDescending }">
              Description<span class="sortArrows"></span>
            </th>
            <th class="sortable"
                ng-click="sortBy('Status')"
                ng-class="{ sorted : sortField == 'Status', desc : sortDescending }">
              Status<span class="sortArrows"></span>
            </th>
            <th class="sortable"
                ng-click="sortBy('PurchaseDate')"
                ng-class="{ sorted : sortField == 'PurchaseDate', desc : sortDescending }">
              Purchased<span class="sortArrows"></span>
            </th>
            <th class="sortable"
                ng-click="sortBy('SellerBusinessName')"
                ng-class="{ sorted : sortField == 'SellerBusinessName', desc : sortDescending }">
              Seller<span class="sortArrows"></span>
            </th>
            <th class="sortable"
                ng-click="sortBy('LastPaymentDate')"
                ng-class="{ sorted : sortField == 'LastPaymentDate', desc : sortDescending }">
              Last Payment<span class="sortArrows"></span>
            </th>
            <th>Title</th>
          </thead>

          <tr ng-repeat="item in data.results">
            <td>
              <p class="lockup-major"> {{ item.FlooringDate | moment }} </p>
              <p class="lockup-minor">{{ item.DaysOnFloorplan }} days</p>
            </td>
            <td>
              <a class="lockup-major" href="#/vehicledetails?stockNumber={{ item.StockNumber }}" nxg-highlight="getVehicleDescription(item)" highlight="item.data.query"></a>

              <div class="row-fluid">
                <p class="lockup-minor caps vin">VIN: <span nxg-highlight="item.UnitVIN" highlight="item.data.query" class="break-word"></span></p>
                <p class="lockup-minor caps stock">STK: <span nxg-highlight="item.StockNumber" highlight="item.data.query"></span></p>
              </div>
            </td>
            <td>
              <p> {{ item.FloorplanStatusName }} </p>
            </td>
            <td>
              <p> {{ item.UnitPurchaseDate | moment }} </p>
            </td>
            <td>
              <p> {{ item.SellerName }} </p>
            </td>
            <td>
              <p class="lockup-major">{{ item.LastPaymentDate | moment }}</p>
             </td>
            <td>
               <a class="btn btn-square" ng-show="item.TitleImageAvailable"
                  ng-href="{{ item.$titleURL }}"
                  nxg-track="{{ metric.VIEW_TITLE }}"
                  target="_blank">
                  <span nxg-icon="icon-title"></span>
                </a>
            </td>
          </tr>
        </table>

        <p class="text-error notice-box" ng-show="data.hitInfiniteScrollMax">
          There are too many results to display, please refine your search further.
        </p>
      </div>
    </div>
  </section>
</section>
