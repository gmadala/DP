# Translating Strings

Translating the actual strings is done by a third party. We are tasked with generating the `.pot` file for them to use when translating, and then converting that back into JS used in the application. Majority of this is handled automatically by __angular-gettext__.


## Translations

Since the actual translations are done by a third party, we do not need to worry about this. All you should know is the basics of how it works.

- We extract the strings from our code
- The extraction tasks generate a `.pot` file which is a standard translation format
- The third party can use an application to open the file, translate each string, then save it for returning to us
- We take the updated translation file and convert it to JS array through our compilation tasks

If you would like to know more about how it works, you can view the [translating guide](http://angular-gettext.rocketeer.be/dev-guide/translate/) on angular-gettext's website.



## Extracting Strings

__angular-gettext__ has a grunt module __grunt-angular-gettext__. If you do not have it on your system yet, a simple `npm install` will get it setup for you since it's included in our package file.

Strings are extracted from the HTML and JS by parsing it and looking for specific code. Here are the sample extraction methods:

__HTML__ uses the directive or filter:

__Directive:__  `<h1 translate>Hello!</h1>`<br>
__Filter:__ `<input placeholder="{{ 'Username' | translate }}" />`

__JS__ uses the javascript methods for extracting and getting:

__Get String:__ `var translated = gettextCatalog.getString("Hello");`<br>
__Get Plural:__ `var myString2 = gettextCatalog.getPlural(count, "Bird", "Birds");`

You can inject `gettextCatalog` into your angular code to use these methods.

__For full documentation__, please see the [Annotating Strings](http://angular-gettext.rocketeer.be/dev-guide/annotate/) dev guide.


### Running Extraction & Other Tasks

You can run an extraction through the grunt task:

`grunt translate`

This runs a few of the translation tasks in the following steps:

- `nggettext_extract` which extracts the text from the HTML and JS files in the app
- `translations_merge` which will merge all of the translated files in `po/translated/*.po`
- `translations_missing` which will find missing strings based on extracted and translated strings
- `nggettext_compile` which will compile the merged strings back into the app

You can run the whole task each time you want to do one of the specific tasks, or you can run them individually if you'd like.

We will breakdown each of the tasks for better understanding:



#### `nggettext_extract`

This will extract all of the strings using the translation code in the HTML and JS files of the app. The output will be stored into `po/extracted.pot`. This file is auto-generated, so do not make any manual changes to it before or after generation.

You shouldn't need to do anything else further with this file since we use it later on to determine the missing strings.

#### `translations_merge`

This will take all of the translated files you've defined in the Gruntfile and merge them into one language specific file. Be sure to update the Gruntfile config each time you add a new translated file. The config will look something like:
  
    translations_merge: {
      all: {
        files: {
          'po/merged/fr_CA.po': [
            'po/translated/fr_CA2.po',
            'po/translated/fr_CA_translated.po',
            'po/translated/NextGear_Web_French (CA).po',
            'po/translated/untranslated_French (CA).po'
          ],
          'po/merged/es.po': [
            'po/translated/es2.po',
            'po/translated/es_MEX_translated.po',
            'po/translated/es.po',
            'po/translated/NextGear_Web_Spanish (Mex).po',
            'po/translated/untranslated_Spanish (Mex).po'
          ]
        }
      }
    }

This config will output two files: `po/merged/fr_CA.po` and `po/merged/es.po`. These files are auto-generated, so do not make any manual changes to it before or after generation. We will use these to match up against the extracted strings to detect missing translations in the next step.

#### `translations_missing`

This will match up your merged translations against the extracted strings to test for missing translations. Gettext has a standard tool for doing this, but it will remove any extra translations from your merged file. This won't work for our case since we have the Desktop and Mobile apps. Sometime strings in Mobile aren't defined in Desktop and vice-versa, causing translations to be removed.

The final result from this task will be output based on the config which is generally `po/untranslate/{lang}.po`. If we add a new language, we need to add it here.

#### `nggettext_compile`

This is a standard method given to use by the gettext tools. It will take our merged translation files and compile them back into JS for us to use in the app. It will output to `app/scripts/translations.js` which is automatically included into the app. You can inject into your code by including `gettextCatalog`.



## Compiling Strings

Again we can use the grunt module to compile our translations. We look for files to compile in `po/merged/*.po`. These are the files we generated from using the merge task included in `grunt translate`.

### Pre-compilation Check

Before running the compilation, we need to confirm the file is valid. This is several steps long, so we have dedicated a new file to this: [Pre-compilation Checks](./Pre-compilation Checks.md)

### Running Compilation

You can run a compilation through the grunt task:

`grunt translate`

Or if you want to run by itself, you can do `grunt nggettext_compile`.

After the compilation is complete, the file will be located at `app/scripts/translations.js`. It is automatically included in the project, so you don't need to take any further action. _This file is auto-generated, so do not make any manual changes to it before or after generation._



## More Info

To see how we translate the strings in our code, please continue on to [Techniques](./3.%20Techniques.md)