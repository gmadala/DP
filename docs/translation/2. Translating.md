# Translating Strings

Translating the actual strings is done by a third party. We are tasked with generating the PO language files for them to use 
when translating, and then converting that back into JS used in the application. Majority of this is handled 
automatically by __angular-gettext__.


## Translations

Since the actual translations are done by a third party, we do not need to worry about this. All you should know is 
the basics of how it works.

- We extract the strings from our code
- The extraction tasks generate a `.pot` file which is a standard translation format
- The third party can use an application to open the file, translate each string, then save it for returning to us
- We take the updated translation file and convert it to JS array through our compilation tasks

If you would like to know more about how it works, you can view the 
[translating guide](http://angular-gettext.rocketeer.be/dev-guide/translate/) on angular-gettext's website.



## Extracting Strings

__angular-gettext__ has a grunt module __grunt-angular-gettext__. If you do not have it on your system yet, a 
simple `npm install` will get it setup for you since it's included in our package file.

Strings are extracted from the HTML and JS by parsing it and looking for specific code. Here are the sample extraction 
methods:

__HTML__ uses the directive or filter:

__Directive:__  `<h1 translate>Hello!</h1>`<br>
__Filter:__ `<input placeholder="{{ 'Username' | translate }}" />`

__JS__ uses the javascript methods for extracting and getting:

__Get String:__ `var translated = gettextCatalog.getString("Hello");`<br>
__Get Plural:__ `var myString2 = gettextCatalog.getPlural(count, "Bird", "Birds");`

You can inject `gettextCatalog` into your angular code to use these methods.

__For full documentation__, please see the [Annotating Strings](http://angular-gettext.rocketeer.be/dev-guide/annotate/) 
dev guide.


### Running Extraction & Other Tasks

You can run an extraction through the grunt task:

`grunt translate`

This runs a few of the translation tasks in the following steps:

- `nggettext_extract` extracts the text to be translated from the HTML and JS files in the app and updates the
  template file "extracted.pot"
- `gettext_update_po` runs gettext msgmerge which updates all the language (PO) files with the new template changes.
  The PO files can then be sent to the translator for translation.
- `nggettext_compile` compiles the merged strings back into the app

You can run the whole task each time you want to do one of the specific tasks, or you can run them individually if 
you'd like.

We will breakdown each of the tasks for better understanding:


#### `nggettext_extract`

This will extract all of the strings using the translation code in the HTML and JS files of the app. The output will be 
stored into `po/extracted.pot`. This file is auto-generated, so do not make any manual changes to it before or after 
generation.

You shouldn't need to do anything else further with this file since we use it later on to determine the missing strings.

#### `gettext_update_po`

This runs gettext msgmerge to update all the language (PO) files with the new template changes (bringing in any new
keys that need translation). It also, looks at the mobile-apps directory to find translation matches. If there are any 
matches then it will pull in that translation (care must be taken then to have the dealer-portal and
mobile-apps directories in the same root directory and should both be kept up-to-date). This task should also lists
how many translations are missing (currently depending on the header in the PO file this value may be off by 1).

Once the PO files have been generated that can be sent to the translator for translation. Historically, this has been
done via email but a much smoother process could be achieved by using an online translation collaboration tool such
as Transifex.

#### `nggettext_compile`

This is a standard method given to use by the gettext tools. It will take our merged translation files and compile them 
back into JS for us to use in the app. It will output to `app/scripts/translations.js` which is automatically included 
into the app. You can inject into your code by including `gettextCatalog`. TODO (we will be modifying this to output
language-specific json files so that users do not have to download other languages)

### Gitignore

Since the POT template file and translations.js are auto-generated we do not usually commit changes to them
and they have been placed in the Gitignore list.

### Pre-compilation Check

Before running the compilation, we need to confirm the file is valid. This is several steps long, so we have dedicated 
a new file to this: [Pre-compilation Checks](./Pre-compilation Checks.md)

## More Info

To see how we translate the strings in our code, please continue on to [Techniques](./3.%20Techniques.md)
